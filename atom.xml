<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-06-20T06:36:02.000Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Mybatis-Plus自定义sql如何添加id</title>
    <link href="http://example.com/2024/04/12/java/Mybatis-Plus%E8%87%AA%E5%AE%9A%E4%B9%89sql%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0id/"/>
    <id>http://example.com/2024/04/12/java/Mybatis-Plus%E8%87%AA%E5%AE%9A%E4%B9%89sql%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0id/</id>
    <published>2024-04-12T15:32:09.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>一直使用Mybatis-Plus，但是自定义sql时，发现没有id，所以记录一下</p></blockquote><p>我有一个需求是需要在inser数据的时候检查是否存在，存在就更新数据，不存在就插入数据，所以自己写了一个upsert语句如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdateNewsBody&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.easy.dataCenter.bean.pojo.AiNewsBody&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">       INSERT INTO `test` (`id`,`news_id`, `news_publish_time`, `news_publish_site`,`news_title`, `news_body`,</span><br><span class="line">       `quota`, `news_message_id`,`news_store_time`, `create_time`)</span><br><span class="line">       VALUES (</span><br><span class="line">       $&#123;@com.baomidou.mybatisplus.core.toolkit.IdWorker@getId()&#125;,</span><br><span class="line">       #&#123;newsBody.newsId&#125;,</span><br><span class="line">       #&#123;newsBody.newsPublishTime&#125;,</span><br><span class="line">       #&#123;newsBody.newsPublishSite&#125;,</span><br><span class="line">       #&#123;newsBody.newsTitle&#125;,</span><br><span class="line">       #&#123;newsBody.newsBody&#125;,</span><br><span class="line">       #&#123;newsBody.quota&#125;,</span><br><span class="line">       #&#123;newsBody.newsMessageId&#125;,</span><br><span class="line">       #&#123;newsBody.newsStoreTime&#125;,</span><br><span class="line">       #&#123;newsBody.createTime&#125;)</span><br><span class="line">       ON DUPLICATE KEY UPDATE</span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;newsBody.newsPublishTime != null and newsBody.newsPublishTime != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">           `news_publish_time` = #&#123;newsBody.newsPublishTime&#125;,</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;newsBody.newsPublishSite != null and newsBody.newsPublishSite != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">           `news_publish_site` = #&#123;newsBody.newsPublishSite&#125;,</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;newsBody.newsTitle != null and newsBody.newsTitle != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">           `news_title` = #&#123;newsBody.newsTitle&#125;,</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;newsBody.newsBody != null and newsBody.newsBody != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">           `news_body`=#&#123;newsBody.newsBody&#125;,</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;newsBody.quota != null and newsBody.quota != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">           `quota` = #&#123;newsBody.quota&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>因为这里需要使用到id，所以需要自己生成id，但是发现生成的id是0，所以需要修改一下，修改如下：</p><pre><code>使用  $&#123;@com.baomidou.mybatisplus.core.toolkit.IdWorker@getId()&#125; 来代替id字段的值，这样就实现了使用mybatis-plus自带的id生成策略</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;一直使用Mybatis-Plus，但是自定义sql时，发现没有id，所以记录一下&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我有一个需求是需要在inser数据的时候检查是否存在，存在就更新数据，不存在就插入数据，所以自己写了一个upsert语句如下</summary>
      
    
    
    
    <category term="mybatis" scheme="http://example.com/categories/mybatis/"/>
    
    
    <category term="Mybatis-Plus" scheme="http://example.com/tags/Mybatis-Plus/"/>
    
  </entry>
  
  <entry>
    <title>mysql主从复制 ( docker-compose )</title>
    <link href="http://example.com/2024/04/02/mysql/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
    <id>http://example.com/2024/04/02/mysql/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</id>
    <published>2024-04-02T10:31:40.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="mysql主从复制"><a href="#mysql主从复制" class="headerlink" title="mysql主从复制"></a>mysql主从复制</h1><blockquote><p>MySQL 主从复制是一种基于日志的复制机制，用于将主服务器（Master）上的数据实时复制到一个或多个从服务器（Slave）。主从复制的原理如下： </p><ol><li>主服务器将所有修改操作记录在二进制日志（Binary Log）中。这些修改可以是插入、更新或删除数据的操作。</li><li>从服务器连接到主服务器，并发送一个请求，请求成为主服务器的从服务器。主服务器收到请求后，将记录从服务器的信息，并开始与从服务器建立复制连接。</li><li>主服务器将二进制日志中的内容发送给从服务器。从服务器接收并执行这些日志中的操作，将数据修改操作反映到自己的数据库上。 </li><li>从服务器还会定期向主服务器发送心跳信息以维持连接。如果主服务器长时间没有收到从服务器的心跳信息，就认为从服务器宕机，不再向其发送日志。 </li><li>如果主服务器发生故障，导致无法提供服务，可以将一个从服务器提升为新的主服务器，以继续提供服务。此时，其他从服务器将切换到新的主服务器上进行复制。 </li><li>通过主从复制，可以实现数据的实时复制和分布式读取，提高数据库的可用性和读取性能。此外，主从复制还可以用于备份数据，当主服务器发生故障时，可以快速切换到从服务器，减少服务停机时间。 </li><li>需要注意的是，主从复制是异步的，从服务器的数据可能稍有延迟。而且主从复制只复制数据修改操作，不复制表结构的变更。如果需要同步表结构的变更，可以使用主从复制搭配其他工具，如 GTID（Global Transaction Identifier）或者基于触发器的解决方案。</li></ol></blockquote><h2 id="创建对应的文件夹"><a href="#创建对应的文件夹" class="headerlink" title="创建对应的文件夹"></a>创建对应的文件夹</h2><pre><code>  mkdir -p /home/mysql/&#123;cnf,logs,mysql&#125;  mkdir -p /home/mysql-slave/&#123;cnf,logs,mysql&#125;</code></pre><h2 id="在cnf文件夹下创建my-cnf文件"><a href="#在cnf文件夹下创建my-cnf文件" class="headerlink" title="在cnf文件夹下创建my.cnf文件"></a>在cnf文件夹下创建my.cnf文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#写入下面配置</span><br><span class="line">[mysqld]</span><br><span class="line">pid-file= /var/run/mysqld/mysqld.pid</span><br><span class="line">socket= /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir= /var/lib/mysql</span><br><span class="line"></span><br><span class="line">default-time_zone=&#x27;+8:00&#x27;</span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">binlog-format=ROW</span><br><span class="line"># 每个服务不一样</span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line">symbolic-links=0</span><br><span class="line">expire_logs_days=7</span><br><span class="line"></span><br><span class="line">max_connections = 2000</span><br><span class="line">max_user_connections = 1900</span><br><span class="line">max_connect_errors = 100000</span><br><span class="line">max_allowed_packet = 50M</span><br><span class="line">lower_case_table_names=0</span><br><span class="line">sql_mode =&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="编写docker-compose-yml文件"><a href="#编写docker-compose-yml文件" class="headerlink" title="编写docker-compose.yml文件"></a>编写docker-compose.yml文件</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">mysql-network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">    <span class="attr">ipam:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">subnet:</span> <span class="number">10.1</span><span class="number">.20</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql-master:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0.32</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql-3124</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3124</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=L3z5uLD@rB1y</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">character-set-server=utf8mb4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">collation-server=utf8mb4_general_ci</span></span><br><span class="line">    <span class="comment">#目录挂载</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/mysql/cnf:/etc/mysql/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/mysql/logs:/logs</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/mysql/mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">mysql-network:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">10.1</span><span class="number">.20</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql-slave:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0.32</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql-3125</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3125</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=L3z5uLD@rB1y</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">character-set-server=utf8mb4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">collation-server=utf8mb4_general_ci</span></span><br><span class="line">    <span class="comment">#目录挂载</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/mysql-slave/cnf:/etc/mysql/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/mysql-slave/logs:/logs</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/mysql-slave/mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">mysql-network:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">10.1</span><span class="number">.20</span><span class="number">.3</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;mysql主从复制&quot;&gt;&lt;a href=&quot;#mysql主从复制&quot; class=&quot;headerlink&quot; title=&quot;mysql主从复制&quot;&gt;&lt;/a&gt;mysql主从复制&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;MySQL 主从复制是一种基于日志的复制机制，用于将主服务</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="mysql" scheme="http://example.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Canal部署</title>
    <link href="http://example.com/2024/03/26/Canal%E9%83%A8%E7%BD%B2/"/>
    <id>http://example.com/2024/03/26/Canal%E9%83%A8%E7%BD%B2/</id>
    <published>2024-03-26T14:07:50.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h1><pre><code>docker pull canal/canal-server:v1.1.7</code></pre><h1 id="启动容器并复制配置文件，然后删除容器"><a href="#启动容器并复制配置文件，然后删除容器" class="headerlink" title="启动容器并复制配置文件，然后删除容器"></a>启动容器并复制配置文件，然后删除容器</h1><pre><code>docker run --name canal-server canal/canal-server:v1.1.7docker cp canal-server:/home/admin/canal-server/conf /opt/canaldocker cp canal-server:/home/admin/canal-server/logs /opt/canaldocker stop canal-server &amp; docker rm canal-server</code></pre><h1 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">canal-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">canal/canal-server:v1.1.7</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">canal-server</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">11111</span><span class="string">:11111</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.auto.scan=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.destinations=xc-canal</span> <span class="comment"># canal实例名称，根据自己喜好命名</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.mysql.slaveId=9527</span> <span class="comment"># canal作为模仿从站的ID，不可与主站重复</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.master.address=117.50.76.162:3306</span> <span class="comment">#mysql的连接地址</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.dbUsername=tlread</span> <span class="comment"># mysql的用户</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.dbPassword=cdxc_read_2024</span> <span class="comment"># mysql的密码</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.connectionCharset=UTF-8</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.tsdb.enable=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.gtidon=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.parser.parallelThreadSize=16</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">canal.instance.filter.regex=api.news_a_share_rel</span> <span class="comment"># 此处为监听的正则表达式过滤，具体参考官网配置，多个用英文逗号隔开&quot;,&quot;,例如：dbname.tablename1,dbname.tablename2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;拉取镜像&quot;&gt;&lt;a href=&quot;#拉取镜像&quot; class=&quot;headerlink&quot; title=&quot;拉取镜像&quot;&gt;&lt;/a&gt;拉取镜像&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;docker pull canal/canal-server:v1.1.7
&lt;/code&gt;&lt;/pre&gt;
&lt;h</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="Canal" scheme="http://example.com/tags/Canal/"/>
    
  </entry>
  
  <entry>
    <title>Centos操作</title>
    <link href="http://example.com/2024/03/26/operation/Centos%E6%93%8D%E4%BD%9C/"/>
    <id>http://example.com/2024/03/26/operation/Centos%E6%93%8D%E4%BD%9C/</id>
    <published>2024-03-26T14:07:50.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h1><h1 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h1><h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 查看已开启的端口</span></span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看防火墙状态</span></span><br><span class="line">firewall-cmd --state</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启防火墙</span></span><br><span class="line">systemctl start firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=6379/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启防火墙</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;基础操作&quot;&gt;&lt;a href=&quot;#基础操作&quot; class=&quot;headerlink&quot; title=&quot;基础操作&quot;&gt;&lt;/a&gt;基础操作&lt;/h1&gt;&lt;h1 id=&quot;网络配置&quot;&gt;&lt;a href=&quot;#网络配置&quot; class=&quot;headerlink&quot; title=&quot;网络配置&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="服务器" scheme="http://example.com/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="Linux" scheme="http://example.com/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/Linux/"/>
    
    
    <category term="CentOS" scheme="http://example.com/tags/CentOS/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearch7.X安装（docker）</title>
    <link href="http://example.com/2023/08/23/installation/Elasticsearch7.X%E5%AE%89%E8%A3%85%EF%BC%88docker%EF%BC%89/"/>
    <id>http://example.com/2023/08/23/installation/Elasticsearch7.X%E5%AE%89%E8%A3%85%EF%BC%88docker%EF%BC%89/</id>
    <published>2023-08-23T09:57:14.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Elasticsearch7-X安装"><a href="#Elasticsearch7-X安装" class="headerlink" title="Elasticsearch7.X安装"></a>Elasticsearch7.X安装</h1><h1 id="单机模式"><a href="#单机模式" class="headerlink" title="单机模式"></a>单机模式</h1><h3 id="创建挂载目录文件夹"><a href="#创建挂载目录文件夹" class="headerlink" title="创建挂载目录文件夹"></a>创建挂载目录文件夹</h3><pre><code>mkdir -p /home/elasticsearch/&#123;config,data,plugins&#125;</code></pre><h3 id="授权文件夹-不然无法启动"><a href="#授权文件夹-不然无法启动" class="headerlink" title="授权文件夹(不然无法启动)"></a>授权文件夹(不然无法启动)</h3><pre><code>chmod 777 /home/elasticsearch/*</code></pre><h3 id="编写docker-compose-yml文件"><a href="#编写docker-compose-yml文件" class="headerlink" title="编写docker-compose.yml文件"></a>编写docker-compose.yml文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">es0:</span></span><br><span class="line">    <span class="comment"># 镜像名</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.17.8</span></span><br><span class="line">    <span class="comment"># 容器名</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dev-es0-19200-19300</span></span><br><span class="line">    <span class="comment"># 重启策略</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 单机模式</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">      <span class="comment"># 配置内存,不然占用会非常大</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ES_JAVA_OPTS=-Xms512m</span> <span class="string">-Xmx512m</span></span><br><span class="line">    <span class="comment"># 端口映射</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">19200</span><span class="string">:9200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">19300</span><span class="string">:9300</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/elasticsearch/data:/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/elasticsearch/plugins:/usr/share/elasticsearch/plugins</span></span><br><span class="line"><span class="comment"># 根据现有docker network配置</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dev</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Es8-的docker配置"><a href="#Es8-的docker配置" class="headerlink" title="Es8 的docker配置"></a>Es8 的docker配置</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">es0:</span></span><br><span class="line">    <span class="comment"># 镜像名</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:8.12.2</span></span><br><span class="line">    <span class="comment"># 容器名</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es8-19200-19300</span></span><br><span class="line">    <span class="comment"># 重启策略</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 单机模式</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">      <span class="comment"># 配置内存,不然占用会非常大</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ES_JAVA_OPTS=-Xms102m</span> <span class="string">-Xmx1024m</span></span><br><span class="line">    <span class="comment"># 端口映射</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">19200</span><span class="string">:9200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">19300</span><span class="string">:9300</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/elasticsearch8/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/elasticsearch8/data:/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/elasticsearch8/plugins:/usr/share/elasticsearch/plugins</span></span><br></pre></td></tr></table></figure><h3 id="elasticsearch-yml"><a href="#elasticsearch-yml" class="headerlink" title="elasticsearch.yml"></a>elasticsearch.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Elasticsearch7-X安装&quot;&gt;&lt;a href=&quot;#Elasticsearch7-X安装&quot; class=&quot;headerlink&quot; title=&quot;Elasticsearch7.X安装&quot;&gt;&lt;/a&gt;Elasticsearch7.X安装&lt;/h1&gt;&lt;h1 id=&quot;单</summary>
      
    
    
    
    <category term="elasticsearch" scheme="http://example.com/categories/elasticsearch/"/>
    
    
    <category term="docker" scheme="http://example.com/tags/docker/"/>
    
    <category term="elasticsearch" scheme="http://example.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu离线安装Docker</title>
    <link href="http://example.com/2023/07/12/installation/Ubuntu%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Docker/"/>
    <id>http://example.com/2023/07/12/installation/Ubuntu%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Docker/</id>
    <published>2023-07-12T11:17:20.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><pre><code>下载路径：https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/</code></pre><h2 id="下载版本"><a href="#下载版本" class="headerlink" title="下载版本"></a>下载版本</h2><pre><code>离线安装docker需要下载3个包，containerd.io ，docker-ce-cli，docker-cecontainerd.io_1.2.6-3_amd64.debdocker-ce_19.03.9_3-0_ubuntu-xenial_amd64.debdocker-ce-cli_19.03.9_3-0_ubuntu-xenial_amd64.deb</code></pre><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><blockquote><p>下载完毕后拷贝到ubuntu上用 dpkg 命令安装，安装顺序：先安装 containerd.io 跟 docker-ce-cli，最后安装docker-ce，命令：sudo<br>dpkg<br>-i xxxx.deb依次执行安装，顺序不能改变</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i containerd.io_1.2.6-3_amd64.deb</span><br><span class="line">dpkg -i docker-ce-cli_19.03.9_3-0_ubuntu-xenial_amd64.deb</span><br><span class="line">dpkg -i docker-ce_19.03.9_3-0_ubuntu-xenial_amd64.deb</span><br></pre></td></tr></table></figure><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><pre><code>systemctl start dockersystemctl status docker </code></pre><h2 id="设置自启动"><a href="#设置自启动" class="headerlink" title="设置自启动"></a>设置自启动</h2><pre><code># 设置 docker自动启动systemctl enable docker.service# 查看docker 在系统中状态systemctl list-unit-files |grep docker</code></pre><h2 id="设置加速"><a href="#设置加速" class="headerlink" title="设置加速"></a>设置加速</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 添加加速镜像</span><br><span class="line">cd /etc</span><br><span class="line">mkdir docker </span><br><span class="line">cd /etc/docker</span><br><span class="line">vim daemon.json</span><br><span class="line"># 将下面复制到daemon.json文件中 https://registry.docker-cn.com</span><br><span class="line">&#123;</span><br><span class="line"> &quot;registry-mirrors&quot;: [&quot;https://81zkznk0.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 重启docker</span><br><span class="line">systemctl restart docker.service</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot; class=&quot;headerlink&quot; title=&quot;下载&quot;&gt;&lt;/a&gt;下载&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;下载路径：https://download.docker.com/linux/ubuntu/dists/xenial/poo</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="docker" scheme="http://example.com/tags/docker/"/>
    
    <category term="linux" scheme="http://example.com/tags/linux/"/>
    
    <category term="ubuntu" scheme="http://example.com/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>docker-compose部署安装gitlab</title>
    <link href="http://example.com/2023/06/28/installation/docker-compose%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85gitlab/"/>
    <id>http://example.com/2023/06/28/installation/docker-compose%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85gitlab/</id>
    <published>2023-06-28T10:27:01.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h1><pre><code>docker pull gitlab/gitlab-ce:nightly</code></pre><h1 id="编写docker-compose-yml"><a href="#编写docker-compose-yml" class="headerlink" title="编写docker-compose.yml"></a>编写docker-compose.yml</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">gitlab:</span></span><br><span class="line">    <span class="comment"># 镜像名</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitlab/gitlab-ce:nightly</span></span><br><span class="line">    <span class="comment"># 容器名</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">test-gitlab</span></span><br><span class="line">    <span class="comment"># 重启策略</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">      <span class="attr">GITLAB_OMNIBUS_CONFIG:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        # #gitlab访问地址，可以写域名。如果端口不写的话默认为80端口</span></span><br><span class="line"><span class="string">        external_url &#x27;http://labs.test.com:2333&#x27;</span></span><br><span class="line"><span class="string">        # #ssh主机ip</span></span><br><span class="line"><span class="string">        gitlab_rails[&#x27;gitlab_shell_ssh_port&#x27;] = 1022</span></span><br><span class="line"><span class="string">        gitlab_rails[&#x27;time_zone&#x27;] = &#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="string">        # 头像图片处理</span></span><br><span class="line"><span class="string">        #gitlab_rails[&#x27;gravatar_plain_url&#x27;] = &#x27;http://sdn.geekzu.org/avatar/%&#123;hash&#125;?s=%&#123;size&#125;&amp;d=identicon&#x27;</span></span><br><span class="line"><span class="string">        gitlab_rails[&#x27;gravatar_ssl_url&#x27;] = &#x27;https://seccdn.libravatar.org/avatar/%&#123;hash&#125;?s=%&#123;size&#125;&amp;d=identicon&#x27;</span></span><br><span class="line"><span class="string">        gitlab_rails[&#x27;backup_path&#x27;] = &quot;/var/opt/gitlab/backups&quot;</span></span><br><span class="line"><span class="string">        # 是否开启nginx代理 此处必须true</span></span><br><span class="line"><span class="string">        nginx[&#x27;enable&#x27;] = true</span></span><br><span class="line"><span class="string">        # https配置根据实际需求来配置, 如果是转发的https则可以不配置</span></span><br><span class="line"><span class="string">        nginx[&#x27;redirect_http_to_https&#x27;] = false</span></span><br><span class="line"><span class="string">        nginx[&#x27;ssl_prefer_server_ciphers&#x27;] = &quot;off&quot;</span></span><br><span class="line"><span class="string">        #nginx[&#x27;ssl_certificate&#x27;] = &quot;/etc/gitlab/ssl/labs.test.com.pem&quot;</span></span><br><span class="line"><span class="string">        #nginx[&#x27;ssl_certificate_key&#x27;] = &quot;/etc/gitlab/ssl/labs.test.com.key&quot;</span></span><br><span class="line"><span class="string"></span>    <span class="comment"># 端口映射</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2333</span><span class="string">:2333</span>   <span class="comment"># 此处端口号须与 external_url 中保持一致，左边和右边都要一样    </span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">443</span><span class="string">:443</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">1022</span><span class="string">:22</span>     <span class="comment"># 这里的1022和上面的1022一致，但是右边必须是22，不能是其他</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/gitlab/config:/etc/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/gitlab/logs:/var/log/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/gitlab/data:/var/opt/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/gitlab/backups:/var/opt/gitlab/backups</span></span><br><span class="line">      <span class="comment"># 该目录下面有初始密码</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/gitlab/etc:/etc/gitlab</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure><h1 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 进入容器内部</span><br><span class="line">docker exec -it gitlab /bin/bash</span><br><span class="line"></span><br><span class="line"># 进入控制台</span><br><span class="line">gitlab-rails console -e production</span><br><span class="line"></span><br><span class="line"># 查询id为1的用户，id为1的用户是超级管理员</span><br><span class="line">user = User.where(id:1).first</span><br><span class="line"># 修改密码为pdl123456</span><br><span class="line">user.password=&#x27;pdl123456&#x27;</span><br><span class="line"># 保存</span><br><span class="line">user.save!</span><br><span class="line"># 退出</span><br><span class="line">exit</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="初始密码"><a href="#初始密码" class="headerlink" title="初始密码"></a>初始密码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在/etc/gitlab目录下面int_password</span><br></pre></td></tr></table></figure><h2 id="日志报错Failed-to-get-final-advertise-address-No-private-IP-address-found-and-explicit-IP-not-provided"><a href="#日志报错Failed-to-get-final-advertise-address-No-private-IP-address-found-and-explicit-IP-not-provided" class="headerlink" title="#日志报错Failed to get final advertise address: No private IP address found, and explicit IP not provided"></a>#日志报错Failed to get final advertise address: No private IP address found, and explicit IP not provided</h2><p>在 /etc/gitlab/gitlab.rb文件末尾追加配置</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   <span class="string">alertmanager[&#x27;flags&#x27;]</span> <span class="string">=</span> &#123;</span><br><span class="line">   <span class="string">&#x27;cluster.advertise-address&#x27;</span> <span class="string">=&gt;</span> <span class="string">&quot;127.0.0.1:9093&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;拉取镜像&quot;&gt;&lt;a href=&quot;#拉取镜像&quot; class=&quot;headerlink&quot; title=&quot;拉取镜像&quot;&gt;&lt;/a&gt;拉取镜像&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;docker pull gitlab/gitlab-ce:nightly
&lt;/code&gt;&lt;/pre&gt;
&lt;h1</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="git" scheme="http://example.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ环境搭建 ( docker )</title>
    <link href="http://example.com/2023/06/27/RocketMQ%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%20(%20docker%20)/"/>
    <id>http://example.com/2023/06/27/RocketMQ%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%20(%20docker%20)/</id>
    <published>2023-06-27T16:29:29.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><blockquote><p>安装前先要安装好docker以及docker-compose</p></blockquote></blockquote><h1 id="常用资料地址"><a href="#常用资料地址" class="headerlink" title="常用资料地址"></a>常用资料地址</h1><ul><li>官方文档地址：<a class="link"   href="https://rocketmq.apache.org/zh/docs/quickStart/01quickstart" >快速开始 | RocketMQ<i class="fas fa-external-link-alt"></i></a></li><li>整合版单机镜像：<a class="link"   href="https://hub.docker.com/r/xuchengen/rocketmq" >xuchengen/rocketmq - Docker Image | Docker Hub<i class="fas fa-external-link-alt"></i></a><ul><li>此镜像 5.1.2 版本存在不能自定义配置文件的问题，几乎无法使用</li></ul></li><li>GitHub<br>地址：<a class="link"   href="https://github.com/apache/rocketmq" >apache/rocketmq: Apache RocketMQ is a cloud native messaging and streaming platform, making it simple to build event-driven applications.<i class="fas fa-external-link-alt"></i></a></li></ul><h1 id="配置解析"><a href="#配置解析" class="headerlink" title="配置解析"></a>配置解析</h1><h2 id="创建数据挂载目录"><a href="#创建数据挂载目录" class="headerlink" title="创建数据挂载目录"></a>创建数据挂载目录</h2><pre><code>mkdir -p /home/rocketmq/&#123;broker/conf,broker/logs,broker/store,console/logs,namesrv/logs&#125;</code></pre><h2 id="broker-conf"><a href="#broker-conf" class="headerlink" title="broker.conf"></a>broker.conf</h2><p>目录：<code>/home/rocketmq/broker/conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"># 是否允许 Broker 自动创建 Topic，建议线下开启，线上关闭</span><br><span class="line">autoCreateTopicEnable=true</span><br><span class="line"></span><br><span class="line"># 是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span><br><span class="line">autoCreateSubscriptionGroup=true</span><br><span class="line"></span><br><span class="line"># Broker角色</span><br><span class="line"># - ASYNC_MASTER 异步复制Master</span><br><span class="line"># - SYNC_MASTER 同步双写Master</span><br><span class="line"># - SLAVE</span><br><span class="line">brokerRole=ASYNC_MASTER</span><br><span class="line"></span><br><span class="line"># 所属集群名字</span><br><span class="line">brokerClusterName = DefaultCluster</span><br><span class="line"></span><br><span class="line"># broker 名字，注意此处不同的配置文件填写的不一样，如果在 broker-a.properties 使用: broker-a,</span><br><span class="line"># 在 broker-b.properties 使用: broker-b</span><br><span class="line">brokerName = broker-a</span><br><span class="line"></span><br><span class="line"># 0 表示 Master，&gt; 0 表示 Slave</span><br><span class="line">brokerId = 0</span><br><span class="line"></span><br><span class="line"># 启动 IP，修改为你宿主机的 IP</span><br><span class="line"># 如果是正式环境，这里一定要填写内网地址（安全）</span><br><span class="line"># 如果是用于测试或者本地这里建议要填外网地址，因为你的本地代码是无法连接到阿里云内网,只能连接外网</span><br><span class="line">#brokerIP1 = 192.168.199.10</span><br><span class="line"></span><br><span class="line"># 在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span><br><span class="line">defaultTopicQueueNums=4</span><br><span class="line"></span><br><span class="line"># 删除文件时间点，默认凌晨4点</span><br><span class="line">deleteWhen=04</span><br><span class="line"></span><br><span class="line"># 文件保留时间，默认48小时</span><br><span class="line">fileReservedTime = 120</span><br><span class="line"></span><br><span class="line"># 刷盘方式</span><br><span class="line"># - ASYNC_FLUSH 异步刷盘</span><br><span class="line"># - SYNC_FLUSH 同步刷盘</span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line"></span><br><span class="line"># Broker 对外服务的监听端口</span><br><span class="line">listenPort=10911</span><br><span class="line"></span><br><span class="line"># 检测物理文件磁盘空间</span><br><span class="line">diskMaxUsedSpaceRatio=88</span><br><span class="line"></span><br><span class="line"># commitLog 每个文件的大小默认 1G，单位 b</span><br><span class="line">mapedFileSizeCommitLog=1073741824</span><br><span class="line"></span><br><span class="line"># ConsumeQueue 每个文件默认存 30W 条，根据业务情况调整</span><br><span class="line">mapedFileSizeConsumeQueue=300000</span><br><span class="line"></span><br><span class="line"># 限制的消息大小，单位 b</span><br><span class="line">maxMessageSize=524288</span><br><span class="line"></span><br><span class="line"># nameServer地址，分号分割</span><br><span class="line"># namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876</span><br><span class="line"></span><br><span class="line"># 存储路径</span><br><span class="line"># storePathRootDir=/home/ztztdata/rocketmq-all-4.1.0-incubating/store</span><br><span class="line"># commitLog 存储路径</span><br><span class="line"># storePathCommitLog=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/commitlog</span><br><span class="line"># 消费队列存储</span><br><span class="line"># storePathConsumeQueue=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/consumequeue</span><br><span class="line"># 消息索引存储路径</span><br><span class="line"># storePathIndex=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/index</span><br><span class="line"># checkpoint 文件存储路径</span><br><span class="line"># storeCheckpoint=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/checkpoint</span><br><span class="line"># abort 文件存储路径</span><br><span class="line"># abortFile=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/abort</span><br><span class="line"># 发消息线程池数量</span><br><span class="line"># sendMessageThreadPoolNums=128</span><br><span class="line"># 拉消息线程池数量</span><br><span class="line"># pullMessageThreadPoolNums=128</span><br><span class="line"></span><br><span class="line"># 未标注</span><br><span class="line"># destroyMapedFileIntervalForcibly=120000</span><br><span class="line"># redeleteHangedFileInterval=120000</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="设置管理界面账号密码-home-rocketmq-console-data-users-properties"><a href="#设置管理界面账号密码-home-rocketmq-console-data-users-properties" class="headerlink" title="设置管理界面账号密码 /home/rocketmq/console/data/users.properties"></a>设置管理界面账号密码 /home/rocketmq/console/data/users.properties</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># This file supports hot change, any change will be auto-reloaded without Console restarting.</span><br><span class="line"># Format: a user per line, username=password[,N] #N is optional, 0 (Normal User); 1 (Admin)</span><br><span class="line"> </span><br><span class="line"># Define Admin</span><br><span class="line"># =============用户名和密码规则「用户名=密码,权限」，这里的权限为1表示管理员，为0表示普通用户=============</span><br><span class="line"># 例如：admin=admin123,1</span><br><span class="line">admin=123456,1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># Define Users</span><br><span class="line"># =============屏蔽下边两个账户=============</span><br><span class="line">#user1=user1</span><br><span class="line">#user2=user2</span><br></pre></td></tr></table></figure><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><blockquote><p>rocketmq.config.loginRequired:开启控制台访问密码</p></blockquote><blockquote><p>rocketmq.config.aclEnabled： broker acl开启</p></blockquote><blockquote><p>rocketmq.config.accessKey： broker acl账号</p></blockquote><blockquote><p>rocketmq.config.secretKey： broker acl密码</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rmqnamesrv:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:5.1.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqnamesrv</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9876</span><span class="string">:9876</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 内存分配</span></span><br><span class="line">      <span class="attr">JAVA_OPT_EXT:</span> <span class="string">&quot;-Duser.home=/home/rocketmq -server -Xms1g -Xmx1g&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/rocketmq/namesrv/logs:/home/rocketmq/logs</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;mqnamesrv&quot;</span> ]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">rmq:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rmqbroker:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:5.1.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqbroker</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10909</span><span class="string">:10909</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10911</span><span class="string">:10911</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/rocketmq/broker/logs:/root/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/rocketmq/broker/store:/root/store</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/rocketmq/broker/conf/broker.conf:/home/rocketmq/broker.conf</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;mqbroker&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/home/rocketmq/broker.conf&quot;</span> ]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">NAMESRV_ADDR:</span> <span class="string">&quot;rmqnamesrv:9876&quot;</span></span><br><span class="line">      <span class="attr">JAVA_OPT_EXT:</span> <span class="string">&quot;-Duser.home=/home/rocketmq -server -Xms1g -Xmx1g -Xmn1g&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">rmq:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">rmqbroker</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rmqdashboard:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apacherocketmq/rocketmq-dashboard:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqdashboard</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">18080</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/console/data:/tmp/rocketmq-console/data</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">JAVA_OPTS:</span> <span class="string">&quot;-Drocketmq.namesrv.addr=rmqnamesrv:9876;rmqnamesrv1:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false -Drocketmq.config.loginRequired=true&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">rmq:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">rmqdashboard</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">rmq:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rmq</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure><h2 id="集群docker-compose-yml参考"><a href="#集群docker-compose-yml参考" class="headerlink" title="集群docker-compose.yml参考"></a>集群docker-compose.yml参考</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rmqnamesrv:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:5.1.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqnamesrv</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9876</span><span class="string">:9876</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 内存分配</span></span><br><span class="line">      <span class="attr">JAVA_OPT_EXT:</span> <span class="string">&quot;-Duser.home=/home/rocketmq -server -Xms128m -Xmx128m&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/namesrv/logs:/home/rocketmq/logs</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;mqnamesrv&quot;</span> ]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">rmq:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rmqnamesrv1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:5.1.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqnamesrv1</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9886</span><span class="string">:9876</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 内存分配</span></span><br><span class="line">      <span class="attr">JAVA_OPT_EXT:</span> <span class="string">&quot;-Duser.home=/home/rocketmq -server -Xms128m -Xmx128m&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/namesrv1/logs:/home/rocketmq/logs</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;mqnamesrv&quot;</span> ]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">rmq:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">rmqnamesrv1</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rmqbroker:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:5.1.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqbroker</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10909</span><span class="string">:10909</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10911</span><span class="string">:10911</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/broker/logs:/home/rocketmq/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/broker/store:/home/rocketmq/store</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/broker/conf/broker.conf:/home/rocketmq/broker.conf</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;mqbroker&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/home/rocketmq/broker.conf&quot;</span> ]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">NAMESRV_ADDR:</span> <span class="string">&quot;rmqnamesrv:9876;rmqnamesrv1:9876&quot;</span></span><br><span class="line">      <span class="attr">JAVA_OPT_EXT:</span> <span class="string">&quot;-Duser.home=/home/rocketmq -server -Xms128m -Xmx128m -Xmn128m&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv1</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">rmq:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">rmqbroker</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rmqbroker1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:5.1.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqbroker1</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10919</span><span class="string">:10909</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10921</span><span class="string">:10911</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/broker1/logs:/home/rocketmq/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/broker1/store:/home/rocketmq/store</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/broker1/conf/broker.conf:/home/rocketmq/broker.conf</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;mqbroker&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/home/rocketmq/broker.conf&quot;</span> ]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">NAMESRV_ADDR:</span> <span class="string">&quot;rmqnamesrv:9876;rmqnamesrv1:9876&quot;</span></span><br><span class="line">      <span class="attr">JAVA_OPT_EXT:</span> <span class="string">&quot;-Duser.home=/home/rocketmq -server -Xms128m -Xmx128m -Xmn128m&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv1</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">rmq:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">rmqbroker1</span></span><br><span class="line">  <span class="comment"># 开启监控，并设置登录密码</span></span><br><span class="line">  <span class="attr">rmqdashboard:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apacherocketmq/rocketmq-dashboard:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqdashboard</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">18080</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/rocketmq/console/data:/tmp/rocketmq-console/data</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">JAVA_OPTS:</span> <span class="string">&quot;-Drocketmq.namesrv.addr=rmqnamesrv:9876;rmqnamesrv1:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false -Drocketmq.config.loginRequired=true&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv1</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">rmq:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">rmqdashboard</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">rmq:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rmq</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure><p>常见问题：</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;安装前先要安装好docker以及docker-compose&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;常用资料地址&quot;&gt;&lt;a href=&quot;#常用资料地址&quot; class=&quot;headerl</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="rocketMQ" scheme="http://example.com/tags/rocketMQ/"/>
    
  </entry>
  
  <entry>
    <title>nginx部署vue前端</title>
    <link href="http://example.com/2023/06/07/web/nginx%E9%83%A8%E7%BD%B2vue%E5%89%8D%E7%AB%AF/"/>
    <id>http://example.com/2023/06/07/web/nginx%E9%83%A8%E7%BD%B2vue%E5%89%8D%E7%AB%AF/</id>
    <published>2023-06-07T15:41:05.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="nginx部署vue前端-增加项目访问前缀"><a href="#nginx部署vue前端-增加项目访问前缀" class="headerlink" title="nginx部署vue前端,增加项目访问前缀"></a>nginx部署vue前端,增加项目访问前缀</h1><blockquote><p>通常我们nginx部署前端只需要默认的端口访问如: <a class="link"   href="http://127.0.0.1:8080/" >http://127.0.0.1:8080<i class="fas fa-external-link-alt"></i></a>,<br>但是有时候多个项目部署在一个地址上,我们需要通过前缀来区分,例如<a class="link"   href="http://127.0.0.1:8080/test1" >http://127.0.0.1:8080/test1<i class="fas fa-external-link-alt"></i></a>, <a class="link"   href="http://127.0.0.1/test2" >http://127.0.0.1/test2<i class="fas fa-external-link-alt"></i></a>.<br>此时就需要非常规配置. 此处我们演示的是docker环境下的nginx配置.docker的nginx配置可以参考<a class="link"   href="https://blog.mattjia.cn/2022/01/12/nginx%E9%83%A8%E7%BD%B2%20(%20docker%20)/" >nginx部署 ( docker )<i class="fas fa-external-link-alt"></i></a></p></blockquote><hr><h1 id="无项目前缀-http-127-0-0-1-8080"><a href="#无项目前缀-http-127-0-0-1-8080" class="headerlink" title="无项目前缀, http://127.0.0.1:8080"></a>无项目前缀, <a class="link"   href="http://127.0.0.1:8080/" >http://127.0.0.1:8080<i class="fas fa-external-link-alt"></i></a></h1><h3 id="vue项目的vu-config-js配置-注意publicPath"><a href="#vue项目的vu-config-js配置-注意publicPath" class="headerlink" title="vue项目的vu.config.js配置, 注意publicPath"></a>vue项目的vu.config.js配置, 注意publicPath</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">assetsDir</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">    <span class="attr">outputDir</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">    <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        config.resolve.alias.set(<span class="string">&#x27;@&#x27;</span>, resolve(<span class="string">&#x27;src&#x27;</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 开启调试</span></span><br><span class="line">    <span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">        <span class="comment">// devtool: process.env.NODE_ENV === &#x27;production&#x27; ? false : &#x27;source-map&#x27;,</span></span><br><span class="line">        <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 自动打开浏览器</span></span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="comment">// 对应的主机名</span></span><br><span class="line">        <span class="attr">port</span>: <span class="number">8080</span>, <span class="comment">// 端口号</span></span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            [process.env.VUE_APP_BASE_API]: &#123;</span><br><span class="line">                <span class="attr">target</span>: process.env.VUE_APP_URL,</span><br><span class="line">                <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">                    [<span class="string">&#x27;^&#x27;</span> + process.env.VUE_APP_BASE_API]: <span class="string">&#x27;&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nginx的配置"><a href="#nginx的配置" class="headerlink" title="nginx的配置"></a>nginx的配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   listen       8080;</span><br><span class="line">   server_name  127.0.0.1;</span><br><span class="line">index index.html index.htm;</span><br><span class="line"></span><br><span class="line">   location / &#123;</span><br><span class="line">       # 此处为挂载目录的指定项目文件夹</span><br><span class="line">       root  /usr/share/nginx/html/test;</span><br><span class="line">       try_files $uri $uri/ /index.html;</span><br><span class="line">       index  index.html index.htm;</span><br><span class="line">   &#125;</span><br><span class="line"># 代理后端接口</span><br><span class="line">location /api/&#123;</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"># 后端接口地址</span><br><span class="line">proxy_pass http://127.0.0.1:9999/;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h1 id="有项目前缀-http-127-0-0-1-8080-test"><a href="#有项目前缀-http-127-0-0-1-8080-test" class="headerlink" title="有项目前缀, http://127.0.0.1:8080/test"></a>有项目前缀, <a class="link"   href="http://127.0.0.1:8080/test" >http://127.0.0.1:8080/test<i class="fas fa-external-link-alt"></i></a></h1><h3 id="vue项目的vu-config-js配置-注意publicPath-1"><a href="#vue项目的vu-config-js配置-注意publicPath-1" class="headerlink" title="vue项目的vu.config.js配置, 注意publicPath"></a>vue项目的vu.config.js配置, 注意publicPath</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">publicPath</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;/test/&#x27;</span> : <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">assetsDir</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">    <span class="attr">outputDir</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">    <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        config.resolve.alias.set(<span class="string">&#x27;@&#x27;</span>, resolve(<span class="string">&#x27;src&#x27;</span>)).set(<span class="string">&#x27;api&#x27;</span>, resolve(<span class="string">&#x27;service/api&#x27;</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 开启调试</span></span><br><span class="line">    <span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">        <span class="comment">// devtool: process.env.NODE_ENV === &#x27;production&#x27; ? false : &#x27;source-map&#x27;,</span></span><br><span class="line">        <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 自动打开浏览器</span></span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="comment">// 对应的主机名</span></span><br><span class="line">        <span class="attr">port</span>: <span class="number">8080</span>, <span class="comment">// 端口号</span></span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            [process.env.VUE_APP_BASE_API]: &#123;</span><br><span class="line">                <span class="attr">target</span>: process.env.VUE_APP_URL,</span><br><span class="line">                <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">                    [<span class="string">&#x27;^&#x27;</span> + process.env.VUE_APP_BASE_API]: <span class="string">&#x27;&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="router-index-js配置"><a href="#router-index-js配置" class="headerlink" title="router/index.js配置"></a>router/index.js配置</h3><h4 id="vue2"><a href="#vue2" class="headerlink" title="vue2"></a>vue2</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">    <span class="attr">base</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;/test/&#x27;</span> : <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    routes,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="vue3"><a href="#vue3" class="headerlink" title="vue3"></a>vue3</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> base = process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;/test/&#x27;</span> : <span class="string">&#x27;/&#x27;</span></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">    <span class="attr">history</span>: createWebHashHistory(base),</span><br><span class="line">    routes,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       8080;</span><br><span class="line">    server_name  127.0.0.1;</span><br><span class="line">index index.html index.htm;</span><br><span class="line"></span><br><span class="line">     location / &#123;</span><br><span class="line">        root  html;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    location /test &#123;</span><br><span class="line">        # 这里要用别名天写项目包路径</span><br><span class="line">        alias  /usr/share/nginx/html/test/;</span><br><span class="line">        # 此处是 前缀/index.html</span><br><span class="line">        try_files $uri $uri/ /test/index.html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">location /api/&#123;</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_pass http://127.0.0.1:9999/;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;nginx部署vue前端-增加项目访问前缀&quot;&gt;&lt;a href=&quot;#nginx部署vue前端-增加项目访问前缀&quot; class=&quot;headerlink&quot; title=&quot;nginx部署vue前端,增加项目访问前缀&quot;&gt;&lt;/a&gt;nginx部署vue前端,增加项目访问前缀&lt;/</summary>
      
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="nginx" scheme="http://example.com/tags/nginx/"/>
    
    <category term="VUE" scheme="http://example.com/tags/VUE/"/>
    
    <category term="前端" scheme="http://example.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>VUE3+TS+ElementPlus二次封装分页</title>
    <link href="http://example.com/2023/02/20/web/VUE3+TS+ElementPlus%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85%E5%88%86%E9%A1%B5/"/>
    <id>http://example.com/2023/02/20/web/VUE3+TS+ElementPlus%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85%E5%88%86%E9%A1%B5/</id>
    <published>2023-02-20T09:46:44.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="编写组件"><a href="#编写组件" class="headerlink" title="编写组件"></a>编写组件</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div :class=&quot;&#123; hidden: hidden &#125;&quot; class=&quot;pagination-container&quot;&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">        v-model:current-page.sync=&quot;paginationData.current&quot;</span><br><span class="line">        v-model:page-size=&quot;paginationData.size&quot;</span><br><span class="line">        :style=&quot;&#123; float: props.isRight ? &#x27;right&#x27; : &#x27;&#x27; &#125;&quot;</span><br><span class="line">        :total=&quot;total&quot;</span><br><span class="line">        :small=&quot;small&quot;</span><br><span class="line">        :background=&quot;background&quot;</span><br><span class="line">        :layout=&quot;layout&quot;</span><br><span class="line">        :page-sizes=&quot;pageSizes&quot;</span><br><span class="line">        v-bind=&quot;$attrs&quot;</span><br><span class="line">        @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">        @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;reactive&#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  // 总数</span><br><span class="line">  total: &#123;</span><br><span class="line">    required: true,</span><br><span class="line">    type: Number,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 页码</span><br><span class="line">  current: &#123;</span><br><span class="line">    type: Number,</span><br><span class="line">    default: 1,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 每页数量</span><br><span class="line">  size: &#123;</span><br><span class="line">    type: Number,</span><br><span class="line">    default: 10,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 每页显示数量</span><br><span class="line">  pageSizes: &#123;</span><br><span class="line">    type: Array,</span><br><span class="line">    default() &#123;</span><br><span class="line">      return [10, 20, 50, 100, 200]</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 显示组件布局</span><br><span class="line">  layout: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;total, sizes, prev, pager, next, jumper&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  small: &#123;</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: false,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 是否为分页按钮添加背景色</span><br><span class="line">  background: &#123;</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  autoScroll: &#123;</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 显示与否</span><br><span class="line">  hidden: &#123;</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: false,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 是否居右</span><br><span class="line">  isRight: &#123;</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: false,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const emit = defineEmits([&#x27;update:current&#x27;, &#x27;update:size&#x27;, &#x27;pagination&#x27;])</span><br><span class="line"></span><br><span class="line">const paginationData = reactive(&#123;</span><br><span class="line">  current: props.current,</span><br><span class="line">  size: props.size,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const handleSizeChange = (val: number) =&gt; &#123;</span><br><span class="line">  emit(&#x27;update:size&#x27;, val)</span><br><span class="line">  emit(&#x27;pagination&#x27;, paginationData)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleCurrentChange = (val: number) =&gt; &#123;</span><br><span class="line">  emit(&#x27;update:current&#x27;, val)</span><br><span class="line">  emit(&#x27;pagination&#x27;, paginationData)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">.pagination-container &#123;</span><br><span class="line">  overflow-x: auto;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.pagination-container.hidden &#123;</span><br><span class="line">  display: none;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Pagination</span><br><span class="line">      @pagination=&quot;handleChangePage&quot;</span><br><span class="line">      :total=&quot;state.tableData.total&quot;</span><br><span class="line">      :current=&quot;state.tableData.queryForm.current&quot;</span><br><span class="line">      :size=&quot;state.tableData.queryForm.size&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;reactive&#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">const state = reactive(&#123;</span><br><span class="line">  tableData: &#123;</span><br><span class="line">    total: 0,</span><br><span class="line">    data: [],</span><br><span class="line">    queryForm: &#123;</span><br><span class="line">      current: 1,</span><br><span class="line">      size: 10,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 分页操作</span><br><span class="line">const handleChangePage = (item: &#123; current: number; size: number &#125;) =&gt; &#123;</span><br><span class="line">  state.tableData.queryForm.current = item.current;</span><br><span class="line">  state.tableData.queryForm.size = item.size;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;编写组件&quot;&gt;&lt;a href=&quot;#编写组件&quot; class=&quot;headerlink&quot; title=&quot;编写组件&quot;&gt;&lt;/a&gt;编写组件&lt;/h1&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;</summary>
      
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="VUE" scheme="http://example.com/tags/VUE/"/>
    
    <category term="分页组件" scheme="http://example.com/tags/%E5%88%86%E9%A1%B5%E7%BB%84%E4%BB%B6/"/>
    
    <category term="ElementPlus" scheme="http://example.com/tags/ElementPlus/"/>
    
  </entry>
  
  <entry>
    <title>docker常用命令操作</title>
    <link href="http://example.com/2022/11/22/operation/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/"/>
    <id>http://example.com/2022/11/22/operation/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/</id>
    <published>2022-11-22T10:45:00.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h1><h2 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h2><pre><code>systemctl start docker</code></pre><h2 id="关闭docker"><a href="#关闭docker" class="headerlink" title="关闭docker"></a>关闭docker</h2><pre><code>systemctl stop docker</code></pre><h2 id="重启docker"><a href="#重启docker" class="headerlink" title="重启docker"></a>重启docker</h2><pre><code>systemctl restart docker</code></pre><h2 id="docker设置随服务启动而自启动"><a href="#docker设置随服务启动而自启动" class="headerlink" title="docker设置随服务启动而自启动"></a>docker设置随服务启动而自启动</h2><pre><code>systemctl enable docker</code></pre><h2 id="查看docker-运行状态"><a href="#查看docker-运行状态" class="headerlink" title="查看docker 运行状态"></a>查看docker 运行状态</h2><pre><code>systemctl status docker</code></pre><h2 id="查看docker-版本号信息"><a href="#查看docker-版本号信息" class="headerlink" title="查看docker 版本号信息"></a>查看docker 版本号信息</h2><pre><code>docker versiondocker info</code></pre><h1 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h1><h2 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h2><pre><code>docker pull 镜像名 docker pull 镜像名:tag</code></pre><h2 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h2><pre><code>docker images</code></pre><h2 id="重新命名"><a href="#重新命名" class="headerlink" title="重新命名"></a>重新命名</h2><pre><code>docker tag 旧镜像:版本 新镜像:版本</code></pre><h2 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h2><pre><code>docker search 镜像名docker search --filter=STARS=9000 mysql 搜索 STARS &gt;9000的 mysql 镜像</code></pre><h2 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h2><pre><code>#删除一个docker rmi -f 镜像名/镜像ID#删除多个 其镜像ID或镜像用用空格隔开即可docker rmi -f 镜像名/镜像ID 镜像名/镜像ID 镜像名/镜像ID#删除全部镜像  -a 意思为显示全部, -q 意思为只显示IDdocker rmi -f $(docker images -aq)</code></pre><h2 id="强制删除镜像"><a href="#强制删除镜像" class="headerlink" title="强制删除镜像"></a>强制删除镜像</h2><pre><code>docker image rm 镜像名称/镜像ID</code></pre><h2 id="导出-导入镜像"><a href="#导出-导入镜像" class="headerlink" title="导出/导入镜像"></a>导出/导入镜像</h2><h3 id="export-import"><a href="#export-import" class="headerlink" title="export/import"></a>export/import</h3><h4 id="export导出"><a href="#export导出" class="headerlink" title="export导出"></a>export导出</h4><pre><code>docker export f299f501774c &gt; hangger_server.tar</code></pre><h4 id="import导入"><a href="#import导入" class="headerlink" title="import导入"></a>import导入</h4><pre><code>docker import - new_hangger_server &lt; hangger_server.tar</code></pre><h3 id="save-load"><a href="#save-load" class="headerlink" title="save/load"></a>save/load</h3><h4 id="save导出"><a href="#save导出" class="headerlink" title="save导出"></a>save导出</h4><pre><code>docker save 0fdf2b4c26d3 &gt; hangge_server.tar# 还可以同时将多个 image 打包成一个文件，比如下面将镜像库中的 postgres 和 mongo 打包：docker save -o images.tar postgres:9.6 mongo:3.4</code></pre><h4 id="load导入"><a href="#load导入" class="headerlink" title="load导入"></a>load导入</h4><pre><code>docker load &lt; hangge_server.tar</code></pre><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><blockquote><p>特别注意：两种方法不可混用。如果使用 import 导入 save 产生的文件，虽然导入不提示错误，但是启动容器时会提示失败，会出现类似”<br>docker: Error response from daemon: Container command not found or does not exist”的错误。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1. 文件大小不同</span><br><span class="line">export 导出的镜像文件体积小于 save 保存的镜像</span><br><span class="line"></span><br><span class="line">2. 是否可以对镜像重命名</span><br><span class="line">docker import 可以为镜像指定新名称</span><br><span class="line">docker load 不能对载入的镜像重命名</span><br><span class="line"></span><br><span class="line">3. 是否可以同时将多个镜像打包到一个文件中</span><br><span class="line">docker export 不支持</span><br><span class="line">docker save 支持</span><br><span class="line"></span><br><span class="line">4. 是否包含镜像历史</span><br><span class="line">export 导出（import 导入）是根据容器拿到的镜像，再导入时会丢失镜像所有的历史记录和元数据信息（即仅保存容器当时的快照状态），所以无法进行回滚操作。</span><br><span class="line">而 save 保存（load 加载）的镜像，没有丢失镜像的历史，可以回滚到之前的层（layer）。</span><br><span class="line"></span><br><span class="line">5. 应用场景不同</span><br><span class="line">docker export 的应用场景：主要用来制作基础镜像，比如我们从一个 ubuntu 镜像启动一个容器，然后安装一些软件和进行一些设置后，使用 docker export 保存为一个基础镜像。然后，把这个镜像分发给其他人使用，比如作为基础的开发环境。</span><br><span class="line">docker save 的应用场景：如果我们的应用是使用 docker-compose.yml 编排的多个镜像组合，但我们要部署的客户服务器并不能连外网。</span><br></pre></td></tr></table></figure><h1 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h1><h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><pre><code>docker run  镜像名# -it 表示 与容器进行交互式启动 -d 表示可后台运行容器 （守护式运行）  --name 给要运行的容器 起的名字  /bin/bash  交互路径docker run -it -d --name 要取的别名 镜像名:Tag /bin/bash</code></pre><h2 id="查看启动容器"><a href="#查看启动容器" class="headerlink" title="查看启动容器"></a>查看启动容器</h2><pre><code>docker ps</code></pre><h2 id="查看所有容器"><a href="#查看所有容器" class="headerlink" title="查看所有容器"></a>查看所有容器</h2><pre><code>docker ps -a</code></pre><h2 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h2><pre><code>#删除一个容器docker rm -f 容器名/容器ID#删除多个容器 空格隔开要删除的容器名或容器IDdocker rm -f 容器名/容器ID 容器名/容器ID 容器名/容器ID#删除全部容器docker rm -f $(docker ps -aq)</code></pre><h2 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h2><pre><code>docker exec -it 容器名/容器ID /bin/bash#进入redis001容器   docker exec -it redis001 /bin/bashdocker attach 容器名/容器ID</code></pre><h2 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h2><pre><code>docker stop 容器ID/容器名</code></pre><h2 id="重启容器"><a href="#重启容器" class="headerlink" title="重启容器"></a>重启容器</h2><pre><code>docker restart 容器ID/容器名</code></pre><h2 id="启动容器-1"><a href="#启动容器-1" class="headerlink" title="启动容器"></a>启动容器</h2><pre><code>docker start 容器ID/容器名</code></pre><h2 id="kill-容器"><a href="#kill-容器" class="headerlink" title="kill 容器"></a>kill 容器</h2><pre><code>docker kill 容器ID/容器名</code></pre><h2 id="容器文件拷贝"><a href="#容器文件拷贝" class="headerlink" title="容器文件拷贝"></a>容器文件拷贝</h2><pre><code>#docker cp 容器ID/名称:文件路径  要拷贝到外部的路径 | 要拷贝到外部的路径  容器ID/名称:文件路径#从容器内 拷出docker cp 容器ID/名称: 容器内路径  容器外路径#从外部 拷贝文件到容器内docker  cp 容器外路径 容器ID/名称: 容器内路径</code></pre><h2 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h2><pre><code>docker logs -f --tail=要查看末尾多少行 默认all 容器ID</code></pre><h2 id="更新容器配置"><a href="#更新容器配置" class="headerlink" title="更新容器配置"></a>更新容器配置</h2><pre><code>docker  update --restart=always 容器Id 或者 容器名或docker container update --restart=always 容器Id 或者 容器名</code></pre><h2 id="更换容器名"><a href="#更换容器名" class="headerlink" title="更换容器名"></a>更换容器名</h2><pre><code>docker rename 容器ID/容器名 新容器名</code></pre><h1 id="运维命令"><a href="#运维命令" class="headerlink" title="运维命令"></a>运维命令</h1><h2 id="查看docker网络"><a href="#查看docker网络" class="headerlink" title="查看docker网络"></a>查看docker网络</h2><pre><code>docker network ls</code></pre><h2 id="创建docker网络"><a href="#创建docker网络" class="headerlink" title="创建docker网络"></a>创建docker网络</h2><pre><code>docker network create app</code></pre><h2 id="查看docker磁盘占用总体情况"><a href="#查看docker磁盘占用总体情况" class="headerlink" title="查看docker磁盘占用总体情况"></a>查看docker磁盘占用总体情况</h2><pre><code>du -hs /var/lib/docker/</code></pre><h2 id="查看Docker的磁盘使用具体情况"><a href="#查看Docker的磁盘使用具体情况" class="headerlink" title="查看Docker的磁盘使用具体情况"></a>查看Docker的磁盘使用具体情况</h2><pre><code>docker system df</code></pre><h2 id="删除-无用的容器和-镜像"><a href="#删除-无用的容器和-镜像" class="headerlink" title="删除 无用的容器和 镜像"></a>删除 无用的容器和 镜像</h2><pre><code>#  删除异常停止的容器docker rm `docker ps -a | grep Exited | awk &#39;&#123;print $1&#125;&#39;`#  删除名称或标签为none的镜像docker rmi -f  `docker images | grep &#39;&lt;none&gt;&#39; | awk &#39;&#123;print $3&#125;&#39;`</code></pre><h2 id="清除所有无容器使用的镜像"><a href="#清除所有无容器使用的镜像" class="headerlink" title="清除所有无容器使用的镜像"></a>清除所有无容器使用的镜像</h2><pre><code># 注意，此命令只要是镜像无容器使用（容器正常运行）都会被删除，包括容器临时停止docker system prune -a</code></pre><h1 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h1><h2 id="docker-compose脚本"><a href="#docker-compose脚本" class="headerlink" title="docker-compose脚本"></a>docker-compose脚本</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># 镜像名</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:bullseye</span></span><br><span class="line">    <span class="comment"># 容器名</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-6379</span></span><br><span class="line">    <span class="comment"># 重启策略</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="comment"># 端口映射</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 设置环境变量 时区上海 编码UTF-8</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">LANG:</span> <span class="string">en_US.UTF-8</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="comment"># 配置文件</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/redis/conf/redis.conf:/usr/local/etc/redis/redis.conf:rw</span></span><br><span class="line">      <span class="comment"># 数据文件</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/redis/data:/data:rw</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--requirepass</span> <span class="number">123456</span></span><br><span class="line"><span class="comment"># 网络</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">hkzs</span></span><br></pre></td></tr></table></figure><h2 id="启动和后台启动"><a href="#启动和后台启动" class="headerlink" title="启动和后台启动"></a>启动和后台启动</h2><pre><code>docker-compose updocker-compose up -d </code></pre><h2 id="执行指定docker-compose文件"><a href="#执行指定docker-compose文件" class="headerlink" title="执行指定docker-compose文件"></a>执行指定docker-compose文件</h2><pre><code>docker-compose -f docker-compose-test.yml up -d</code></pre><h2 id="停止和重启以及彻底干掉容器"><a href="#停止和重启以及彻底干掉容器" class="headerlink" title="停止和重启以及彻底干掉容器"></a>停止和重启以及彻底干掉容器</h2><pre><code>docker-compose stop docker-compose restartdocker-compose down</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;基础命令&quot;&gt;&lt;a href=&quot;#基础命令&quot; class=&quot;headerlink&quot; title=&quot;基础命令&quot;&gt;&lt;/a&gt;基础命令&lt;/h1&gt;&lt;h2 id=&quot;启动docker&quot;&gt;&lt;a href=&quot;#启动docker&quot; class=&quot;headerlink&quot; title=&quot;启</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="命令行" scheme="http://example.com/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"/>
    
    <category term="操作" scheme="http://example.com/tags/%E6%93%8D%E4%BD%9C/"/>
    
  </entry>
  
  <entry>
    <title>mysql安装 ( linux压缩包 )</title>
    <link href="http://example.com/2022/11/22/mysql/mysql%E5%AE%89%E8%A3%85%20(%20linux%E5%8E%8B%E7%BC%A9%E5%8C%85%20)/"/>
    <id>http://example.com/2022/11/22/mysql/mysql%E5%AE%89%E8%A3%85%20(%20linux%E5%8E%8B%E7%BC%A9%E5%8C%85%20)/</id>
    <published>2022-11-22T10:24:00.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>压缩包安装方便修改配置<br>下载，到<a class="link"   href="http://dev.mysql.com/" >MySQL官网<i class="fas fa-external-link-alt"></i></a> ,点击Downloads=&gt;Community=&gt;MySQL Community Server</p></blockquote><h1 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h1><h2 id="监测本机是否存在mysql"><a href="#监测本机是否存在mysql" class="headerlink" title="监测本机是否存在mysql"></a>监测本机是否存在mysql</h2><pre><code>rpm -qa|grep -i mysql查找之前的MySQL目录，并使用rm -rf 文件夹名，删除find / -name mysql。</code></pre><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="解压下载后的版本"><a href="#解压下载后的版本" class="headerlink" title="解压下载后的版本"></a>解压下载后的版本</h2><pre><code>tar -zxvf mysql-5.7.37-linux-glibc2.12-x86_64.tar.gz</code></pre><h2 id="将解压后的MySQL移动到自己想要的位置"><a href="#将解压后的MySQL移动到自己想要的位置" class="headerlink" title="将解压后的MySQL移动到自己想要的位置"></a>将解压后的MySQL移动到自己想要的位置</h2><pre><code>mv mysql-5.7.37-linux-glibc2.12-x86_64  /data/mysql</code></pre><h1 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h1><h2 id="在MySQL目录下新建data目录"><a href="#在MySQL目录下新建data目录" class="headerlink" title="在MySQL目录下新建data目录"></a>在MySQL目录下新建data目录</h2><pre><code>cd /data/mysql mkdir data</code></pre><h2 id="在系统中新建-etc-my-cnf，文件内容如下，目录可改成本机的："><a href="#在系统中新建-etc-my-cnf，文件内容如下，目录可改成本机的：" class="headerlink" title="在系统中新建/etc/my.cnf，文件内容如下，目录可改成本机的："></a>在系统中新建/etc/my.cnf，文件内容如下，目录可改成本机的：</h2><pre><code>cd /etc/my.cnfvi my.cnf</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># 不需要密码验证</span><br><span class="line">skip-grant-tables</span><br><span class="line"></span><br><span class="line">datadir=/usr/local/mysql/data</span><br><span class="line">basedir=/usr/local/mysql</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">user=mysql</span><br><span class="line">port=3306</span><br><span class="line">character-set-server=utf8</span><br><span class="line"></span><br><span class="line"># 是否区分大小写，0:区分大小写(默认), 1:不区分大小写</span><br><span class="line">lower_case_table_names=0</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=20</span><br><span class="line">＃ 创建新表时将使用的默认引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line"># 建议禁用符号链接以防止各种安全风险</span><br><span class="line">symbolic-links=0</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="打开vim-etc-profile"><a href="#打开vim-etc-profile" class="headerlink" title="打开vim /etc/profile"></a>打开vim /etc/profile</h1><pre><code>vim /etc/profileexport PATH=$PATH:/usr/local/mysql/binsource /etc/profile</code></pre><h1 id="在MySQL目录下执行如下命令，初始化数据库"><a href="#在MySQL目录下执行如下命令，初始化数据库" class="headerlink" title="在MySQL目录下执行如下命令，初始化数据库"></a>在MySQL目录下执行如下命令，初始化数据库</h1><pre><code>./bin/mysqld --initialize --user=mysql --basedir=/data/mysql/ --datadir=/data/mysql/data/</code></pre><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><pre><code>service mysql start</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;压缩包安装方便修改配置&lt;br&gt;下载，到&lt;a class=&quot;link&quot;   href=&quot;http://dev.mysql.com/&quot; &gt;MySQL官网&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt; ,点击Do</summary>
      
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="linux" scheme="http://example.com/tags/linux/"/>
    
    <category term="mysql" scheme="http://example.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7.X离线安装docker</title>
    <link href="http://example.com/2022/11/22/installation/CentOS7.X%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85docker/"/>
    <id>http://example.com/2022/11/22/installation/CentOS7.X%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85docker/</id>
    <published>2022-11-22T10:10:00.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h1><h2 id="下载docker的安装包"><a href="#下载docker的安装包" class="headerlink" title="下载docker的安装包"></a>下载docker的安装包</h2><p><a class="link"   href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" >docker安装包<i class="fas fa-external-link-alt"></i></a><br>需要的依赖:</p><ol><li><a class="link"   href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" >docker-ce-cli<i class="fas fa-external-link-alt"></i></a></li><li><a class="link"   href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" >containerd.io<i class="fas fa-external-link-alt"></i></a></li><li><a class="link"   href="http://mirror.centos.org/centos/7/extras/x86_64/Packages/container-selinux-2.119.2-1.911c772.el7_8.noarch.rpm" >container-selinux<i class="fas fa-external-link-alt"></i></a></li></ol><h2 id="执行安装命令"><a href="#执行安装命令" class="headerlink" title="执行安装命令"></a>执行安装命令</h2><blockquote><p>先安装依赖再安装docker</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh docker-ce-cli-24.0.4-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh container-selinux-2.119.2-1.911c772.el7_8.noarch.rpm</span><br><span class="line">rpm -ivh containerd.io-1.6.9-3.1.el7.x86_64.rpm      </span><br><span class="line"></span><br><span class="line">rpm -ivh docker-ce-24.0.4-1.el7.x86_64.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line">systemctl start docker </span><br><span class="line"># 查看状态</span><br><span class="line">systemctl status docker </span><br><span class="line"># 开启docker开机自启动</span><br><span class="line">systemctl enable docker.service</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h1><h2 id="下载上传安装文件并解压安装"><a href="#下载上传安装文件并解压安装" class="headerlink" title="下载上传安装文件并解压安装"></a>下载上传安装文件并解压安装</h2><p><a class="link"   href="https://download.docker.com/linux/static/stable/x86_64/" >docker下载<i class="fas fa-external-link-alt"></i></a></p><h2 id="将解压出来的docker文件复制到-usr-bin-目录下"><a href="#将解压出来的docker文件复制到-usr-bin-目录下" class="headerlink" title="将解压出来的docker文件复制到 /usr/bin/ 目录下"></a>将解压出来的docker文件复制到 /usr/bin/ 目录下</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp docker/* /usr/bin/</span><br></pre></td></tr></table></figure><h2 id="进入-etc-systemd-system-目录-并创建docker-service文件"><a href="#进入-etc-systemd-system-目录-并创建docker-service文件" class="headerlink" title="进入/etc/systemd/system/目录,并创建docker.service文件"></a>进入/etc/systemd/system/目录,并创建docker.service文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/systemd/system/</span><br><span class="line">touch docker.service</span><br></pre></td></tr></table></figure><h2 id="打开docker-service文件-将以下内容复制-注意：-–insecure-registry-192-168-200-128-此处改为你自己服务器ip"><a href="#打开docker-service文件-将以下内容复制-注意：-–insecure-registry-192-168-200-128-此处改为你自己服务器ip" class="headerlink" title="打开docker.service文件,将以下内容复制 注意： –insecure-registry=192.168.200.128 此处改为你自己服务器ip"></a>打开docker.service文件,将以下内容复制 注意： –insecure-registry=192.168.200.128 此处改为你自己服务器ip</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line"># the default is not to use systemd for cgroups because the delegate issues still</span><br><span class="line"># exists and systemd currently does not support the cgroup feature set required</span><br><span class="line"># for containers run by docker</span><br><span class="line">ExecStart=/usr/bin/dockerd --selinux-enabled=false --insecure-registry=192.168.200.128</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="line"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"># Uncomment TasksMax if your systemd version supports it.</span><br><span class="line"># Only systemd 226 and above support this version.</span><br><span class="line">#TasksMax=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line"># set delegate yes so that systemd does not reset the cgroups of docker containers</span><br><span class="line">Delegate=yes</span><br><span class="line"># kill only the docker process, not all processes in the cgroup</span><br><span class="line">KillMode=process</span><br><span class="line"># restart the docker process if it exits prematurely</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="给docker-service文件添加执行权限"><a href="#给docker-service文件添加执行权限" class="headerlink" title="给docker.service文件添加执行权限"></a>给docker.service文件添加执行权限</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /etc/systemd/system/docker.service </span><br></pre></td></tr></table></figure><h2 id="重新加载配置文件（每次有修改docker-service文件时都要重新加载下）"><a href="#重新加载配置文件（每次有修改docker-service文件时都要重新加载下）" class="headerlink" title="重新加载配置文件（每次有修改docker.service文件时都要重新加载下）"></a>重新加载配置文件（每次有修改docker.service文件时都要重新加载下）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload </span><br></pre></td></tr></table></figure><h2 id="启动配置"><a href="#启动配置" class="headerlink" title="启动配置"></a>启动配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line">systemctl start docker</span><br><span class="line"># 设置开机启动</span><br><span class="line">systemctl enable docker.service</span><br><span class="line"># 查看状态</span><br><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;第一种&quot;&gt;&lt;a href=&quot;#第一种&quot; class=&quot;headerlink&quot; title=&quot;第一种&quot;&gt;&lt;/a&gt;第一种&lt;/h1&gt;&lt;h2 id=&quot;下载docker的安装包&quot;&gt;&lt;a href=&quot;#下载docker的安装包&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="docker" scheme="http://example.com/tags/docker/"/>
    
    <category term="centos" scheme="http://example.com/tags/centos/"/>
    
    <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>mysql安装 ( docker )</title>
    <link href="http://example.com/2022/11/08/mysql/mysql%E5%AE%89%E8%A3%85%20(%20docker%20)%20/"/>
    <id>http://example.com/2022/11/08/mysql/mysql%E5%AE%89%E8%A3%85%20(%20docker%20)%20/</id>
    <published>2022-11-08T11:52:53.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Mysql5-X安装"><a href="#Mysql5-X安装" class="headerlink" title="Mysql5.X安装"></a>Mysql5.X安装</h1><h2 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><pre><code>docker pull  mysql:5.7.31</code></pre><h2 id="创建挂载文件"><a href="#创建挂载文件" class="headerlink" title="创建挂载文件"></a>创建挂载文件</h2><pre><code>mkdir /data/mysql/&#123;cnf,logs,mysql&#125;</code></pre><h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><pre><code>vi /data/mysql/cnf/my.cnf</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#写入下面配置</span><br><span class="line">[mysqld]</span><br><span class="line">pid-file= /var/run/mysqld/mysqld.pid</span><br><span class="line">socket= /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir= /var/lib/mysql</span><br><span class="line">log-error= /var/log/mysql/error.log</span><br><span class="line"></span><br><span class="line">default-time_zone=&#x27;+8:00&#x27;</span><br><span class="line"></span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">binlog-format=ROW</span><br><span class="line">server_id=2</span><br><span class="line"></span><br><span class="line">symbolic-links=0</span><br><span class="line">expire_logs_days=7</span><br><span class="line"></span><br><span class="line">max_connections = 2000</span><br><span class="line">max_user_connections = 1900</span><br><span class="line">max_connect_errors = 100000</span><br><span class="line">max_allowed_packet = 50M</span><br><span class="line">lower_case_table_names=0</span><br><span class="line">sql_mode =&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">character-set-server=utf8</span><br></pre></td></tr></table></figure><h2 id="编写docker-compose文件"><a href="#编写docker-compose文件" class="headerlink" title="编写docker-compose文件"></a>编写docker-compose文件</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7.31</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql-5.7.31</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=root</span>  </span><br><span class="line">    <span class="comment">#目录挂载</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/mysql/conf:/etc/mysql/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/mysql/logs:/logs</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/mysql/mysql:/var/lib/mysql</span></span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><pre><code>docker-compose up -d#查看日志docker-compose logs -f </code></pre><h2 id="配置远程访问"><a href="#配置远程访问" class="headerlink" title="配置远程访问"></a>配置远程访问</h2><pre><code>#进入mysql容器docker exec -it mysql-5.7.31 bash#登录mysqlmysql -uroot -proot#创建用户并添加权限grant all privileges on 库名.* to 登录名@&#39;%&#39; identified by &#39;123456&#39;;#刷新mysql权限FLUSH PRIVILEGES;#退出exit;</code></pre><h1 id="Mysql8-X安装"><a href="#Mysql8-X安装" class="headerlink" title="Mysql8.X安装"></a>Mysql8.X安装</h1><h2 id="拉取镜像-1"><a href="#拉取镜像-1" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><pre><code>docker pull mysql:8.0.31</code></pre><h2 id="创建挂载文件-1"><a href="#创建挂载文件-1" class="headerlink" title="创建挂载文件"></a>创建挂载文件</h2><pre><code>mkdir /data/mysql/&#123;cnf,logs,mysql&#125;</code></pre><h2 id="创建配置文件-1"><a href="#创建配置文件-1" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><pre><code>vi /data/mysql/cnf/my.cnf</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#写入下面配置</span><br><span class="line">[mysqld]</span><br><span class="line">pid-file= /var/run/mysqld/mysqld.pid</span><br><span class="line">socket= /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir= /var/lib/mysql</span><br><span class="line"></span><br><span class="line">default-time_zone=&#x27;+8:00&#x27;</span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">binlog-format=ROW</span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line">symbolic-links=0</span><br><span class="line">expire_logs_days=7</span><br><span class="line"></span><br><span class="line">max_connections = 2000</span><br><span class="line">max_user_connections = 1900</span><br><span class="line">max_connect_errors = 100000</span><br><span class="line">max_allowed_packet = 50M</span><br><span class="line">lower_case_table_names=0</span><br><span class="line">sql_mode =&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="编写docker-compose文件-1"><a href="#编写docker-compose文件-1" class="headerlink" title="编写docker-compose文件"></a>编写docker-compose文件</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql-3310:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0.31</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql-3310</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3310</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">character-set-server=utf8mb4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">collation-server=utf8mb4_general_ci</span></span><br><span class="line">    <span class="comment">#目录挂载</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/mysql/cnf:/etc/mysql/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/mysql/logs:/logs</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/mysql/mysql:/var/lib/mysql</span></span><br></pre></td></tr></table></figure><h2 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h2><pre><code>docker-compose up -d# 查看日志docker-compose logs -f </code></pre><h2 id="配置远程访问-1"><a href="#配置远程访问-1" class="headerlink" title="配置远程访问"></a>配置远程访问</h2><pre><code># 进入mysql容器docker exec -it mysql-5.7.31 bash# 登录mysqlmysql -uroot -proot# 在mysql8.0创建用户和授权和之前不太一样了，其实严格上来讲，也不能说是不一样,只能说是更严格,mysql8.0需要先创建用户和设置密码,然后才能授权. # 先创建一个用户create user &#39;test&#39;@&#39;%&#39; identified by &#39;123123&#39;;   # 再进行授权grant all privileges on *.* to &#39;test&#39;@&#39;%&#39; with grant option;# 修改远程加密规则:ALTER USER &#39;test&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;123123&#39;;# 刷新权限:FLUSH PRIVILEGES;#OK，设置完成，再次使用 Navicat 连接数据库</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Mysql5-X安装&quot;&gt;&lt;a href=&quot;#Mysql5-X安装&quot; class=&quot;headerlink&quot; title=&quot;Mysql5.X安装&quot;&gt;&lt;/a&gt;Mysql5.X安装&lt;/h1&gt;&lt;h2 id=&quot;拉取镜像&quot;&gt;&lt;a href=&quot;#拉取镜像&quot; class=&quot;head</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="mysql" scheme="http://example.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Sentinel部署 ( docker )</title>
    <link href="http://example.com/2022/02/14/Sentinel%E9%83%A8%E7%BD%B2%20(%20docker%20)%20/"/>
    <id>http://example.com/2022/02/14/Sentinel%E9%83%A8%E7%BD%B2%20(%20docker%20)%20/</id>
    <published>2022-02-14T14:49:24.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>由于Sentinel官方并没有提供相对应的docker官方镜像，为了方便容器环境下使用，我们使用官方提供的sentinel jar包制作sentinel dashboard的docker镜像， 并将镜像发布到dockerhub方便使用sentinel的镜像。</p><p>示例版本为1.8.3</p></blockquote><h1 id="下载官方jar包-并上传服务器"><a href="#下载官方jar包-并上传服务器" class="headerlink" title="下载官方jar包, 并上传服务器"></a>下载官方jar包, 并上传服务器</h1><blockquote><p><a class="link"   href="https://github.com/alibaba/Sentinel/releases" >Sentinel<i class="fas fa-external-link-alt"></i></a></p></blockquote><h1 id="创建Sentinel的Dockerfile镜像制作脚本"><a href="#创建Sentinel的Dockerfile镜像制作脚本" class="headerlink" title="创建Sentinel的Dockerfile镜像制作脚本"></a>创建Sentinel的Dockerfile镜像制作脚本</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">###########sentinel dashboard的Dockerfile镜像脚本#########</span><br><span class="line">#引入依赖的java环境</span><br><span class="line">FROM openjdk:8-alpine3.9</span><br><span class="line"> </span><br><span class="line">#工作环境变量配置</span><br><span class="line">ENV SENTINEL_HOME=/opt/sentinel</span><br><span class="line">#版本环境变量配置 这里配置版本为下载的版本</span><br><span class="line">ENV SENTINEL_DASHBOARD_VERSION=1.8.3</span><br><span class="line"> </span><br><span class="line">CMD [&quot;/bin/bash&quot;]</span><br><span class="line"> </span><br><span class="line">#工作目录</span><br><span class="line">WORKDIR $&#123;SENTINEL_HOME&#125;</span><br><span class="line"> </span><br><span class="line">#作者信息</span><br><span class="line">MAINTAINER Matt &lt;myismatt@foxmail.com&gt;</span><br><span class="line"> </span><br><span class="line">#添加sentinel dashboard镜像源</span><br><span class="line">ADD sentinel-dashboard-$&#123;SENTINEL_DASHBOARD_VERSION&#125;.jar $&#123;SENTINEL_HOME&#125;/sentinel-dashboard-$&#123;SENTINEL_DASHBOARD_VERSION&#125;.jar</span><br><span class="line"> </span><br><span class="line">#暴露端口</span><br><span class="line">EXPOSE 8080</span><br><span class="line"> </span><br><span class="line">#启动命令</span><br><span class="line">ENTRYPOINT java -Dserver.port=8080 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-$&#123;SENTINEL_DASHBOARD_VERSION&#125;.jar</span><br></pre></td></tr></table></figure><h1 id="编译脚本"><a href="#编译脚本" class="headerlink" title="编译脚本"></a>编译脚本</h1><pre><code>docker build -f Dockerfile -t sentinel-dashboard:1.8.3 .</code></pre><h1 id="编写docker-compose-yml"><a href="#编写docker-compose-yml" class="headerlink" title="编写docker-compose.yml"></a>编写docker-compose.yml</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3&#x27;</span><br><span class="line">services:</span><br><span class="line"> sentinel:</span><br><span class="line">    image: sentinel-dashboard:1.8.3</span><br><span class="line">    container_name: sentinel</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: true</span><br><span class="line">    ports:</span><br><span class="line">        - 8858:8858</span><br></pre></td></tr></table></figure><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><pre><code>docker-compose up -d</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;由于Sentinel官方并没有提供相对应的docker官方镜像，为了方便容器环境下使用，我们使用官方提供的sentinel jar包制作sentinel dashboard的docker镜像， 并将镜像发布到dockerhub方便使用sentine</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="sentinel" scheme="http://example.com/tags/sentinel/"/>
    
  </entry>
  
  <entry>
    <title>nginx部署 ( docker )</title>
    <link href="http://example.com/2022/01/12/nginx%E9%83%A8%E7%BD%B2%20(%20docker%20)/"/>
    <id>http://example.com/2022/01/12/nginx%E9%83%A8%E7%BD%B2%20(%20docker%20)/</id>
    <published>2022-01-12T16:45:46.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:1.19.8</span><br></pre></td></tr></table></figure><h1 id="创建关联文件"><a href="#创建关联文件" class="headerlink" title="创建关联文件"></a>创建关联文件</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#创建文件夹</span><br><span class="line">mkdir /data/&#123;conf,conf.d,html,logs&#125;</span><br><span class="line">#编辑nginx.conf配置 配置内容在文后</span><br><span class="line">cd conf</span><br><span class="line">vi nginx.conf</span><br><span class="line">#编辑default.conf配置 配置内容在文后</span><br><span class="line">cd conf.d</span><br><span class="line">vi default.conf</span><br></pre></td></tr></table></figure><h1 id="创建docker-compose-yml"><a href="#创建docker-compose-yml" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3&#x27;</span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    # 镜像名</span><br><span class="line">    image: nginx:1.19.8</span><br><span class="line">    # 容器名</span><br><span class="line">    container_name: matt-nginx</span><br><span class="line">    # 重启策略</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: true    </span><br><span class="line">    # 端口映射</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80                </span><br><span class="line">      - 8080:8080</span><br><span class="line">    # 挂载目录 </span><br><span class="line">    volumes:</span><br><span class="line">      - /home/docker-container/nginx/conf/nginx.conf:/etc/nginx/nginx.conf</span><br><span class="line">      - /home/docker-container/nginx/conf.d:/etc/nginx/conf.d</span><br><span class="line">      - /home/docker-container/nginx/html:/usr/share/nginx/html</span><br><span class="line">      - /home/docker-container/nginx/logs:/var/log/nginx</span><br><span class="line">    environment:</span><br><span class="line">        - TZ=Asia/Shanghai</span><br></pre></td></tr></table></figure><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><blockquote><p>将需要代理的前端vue项目放入html文件夹中, 在conf.d文件夹中加入nginx配置文件,重启nginx即可</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h2 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="default-conf"><a href="#default-conf" class="headerlink" title="default.conf"></a>default.conf</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="nginx代理配置文件示例"><a href="#nginx代理配置文件示例" class="headerlink" title="nginx代理配置文件示例"></a>nginx代理配置文件示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       8080;</span><br><span class="line">    server_name  127.0.0.1;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        #此处填写的地址是docker容器的html地址,因为我们已经做了挂载,例如宿主机/data/nginx/html/demo,则下面root应该填写/usr/share/nginx/html/demo</span><br><span class="line">        root  /usr/share/nginx/html/demo;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    location /api/&#123;</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_pass http://172.19.20.129:8090/;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;拉取镜像&quot;&gt;&lt;a href=&quot;#拉取镜像&quot; class=&quot;headerlink&quot; title=&quot;拉取镜像&quot;&gt;&lt;/a&gt;拉取镜像&lt;/h1&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="nginx" scheme="http://example.com/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Github资源</title>
    <link href="http://example.com/2021/12/06/Github%E8%B5%84%E6%BA%90/"/>
    <id>http://example.com/2021/12/06/Github%E8%B5%84%E6%BA%90/</id>
    <published>2021-12-06T09:47:12.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Free-Programming-Books"><a href="#Free-Programming-Books" class="headerlink" title="Free Programming Books"></a>Free Programming Books</h1><blockquote><p>在我看来，这是一个几乎汇集了所有免费的编程课程和书籍的网站。我最喜欢这里的一点是它区分了许多不同的语言，这可以帮助我们轻松选择适合自己的书。除了阅读文档之外，它还为，例如<br>popcast、视频、代码演练……</p></blockquote><p><a class="link"   href="https://github.com/EbookFoundation/free-programming-books" >Free Programming Books<i class="fas fa-external-link-alt"></i></a></p><h1 id="Web-Developer-Road-Map"><a href="#Web-Developer-Road-Map" class="headerlink" title="Web Developer Road Map"></a>Web Developer Road Map</h1><blockquote><p>2021 年成为 Web 开发人员的路线图，包括前端、后端和DevOps。</p></blockquote><p><a class="link"   href="https://github.com/kamranahmedse/developer-roadmap" >Web Developer Road Map<i class="fas fa-external-link-alt"></i></a></p><h1 id="Coding-Interview-University"><a href="#Coding-Interview-University" class="headerlink" title="Coding Interview University"></a>Coding Interview University</h1><blockquote><p>该仓库为开发人员提供了通往美国大型互联网公司的完整面试、学习指南，其中列出的题目和项目将为你在任何软件公司的技术面试前做好准备。</p></blockquote><p><a class="link"   href="https://github.com/jwasham/coding-interview-university" >Coding Interview University<i class="fas fa-external-link-alt"></i></a></p><h1 id="JavaScript-Questions"><a href="#JavaScript-Questions" class="headerlink" title="JavaScript Questions"></a>JavaScript Questions</h1><blockquote><p>该网站汇总了 Javascript 编程语言从基础到高级的问题。我最喜欢它的一点是它对每个问题都有非常详细的答案和说明。它也被翻译成了许多不同的语言。</p></blockquote><p><a class="link"   href="https://github.com/lydiahallie/javascript-questions/" >JavaScript Questions<i class="fas fa-external-link-alt"></i></a></p><h1 id="Clean-Code-Javascript"><a href="#Clean-Code-Javascript" class="headerlink" title="Clean Code Javascript"></a>Clean Code Javascript</h1><blockquote><p>它综合了作者在使用 Javascript编程语言工作期间的编码经验。它帮助我们学习如何编写易于理解、易于重用的代码，并提高代码的效率</p></blockquote><p><a class="link"   href="https://github.com/ryanmcdermott/clean-code-javascript" >Clean Code Javascript<i class="fas fa-external-link-alt"></i></a></p><h1 id="Tech-Interview-Handbook"><a href="#Tech-Interview-Handbook" class="headerlink" title="Tech Interview Handbook"></a>Tech Interview Handbook</h1><blockquote><p>The Tech Interview Handbook是一个网站，它汇总了开发人员的面试经验，例如编写简历、介绍、面试常见问题、算法和编程中的常用技术</p></blockquote><p><a class="link"   href="https://github.com/yangshun/tech-interview-handbook" >Tech Interview Handbook<i class="fas fa-external-link-alt"></i></a></p><h1 id="Free-For-Dev"><a href="#Free-For-Dev" class="headerlink" title="Free For Dev"></a>Free For Dev</h1><blockquote><p>Free For Dev 是一个整合编程项目链接和免费网络服务的地方，例如网络托管、存储媒体处理、云提供商、API、CDN、DNS、CMS……</p></blockquote><p><a class="link"   href="https://github.com/ripienaar/free-for-dev" >Free For Dev<i class="fas fa-external-link-alt"></i></a></p><h1 id="Public-APIs"><a href="#Public-APIs" class="headerlink" title="Public APIs"></a>Public APIs</h1><blockquote><p>公共 API 是用于网站开发的免费 API 服务的集合，例如用于体育、社会、天气、金融……的 API</p></blockquote><p><a class="link"   href="https://github.com/public-apis/public-apis" >Public APIs<i class="fas fa-external-link-alt"></i></a></p><h1 id="You-Don’t-Know-JS"><a href="#You-Don’t-Know-JS" class="headerlink" title="You Don’t Know JS"></a>You Don’t Know JS</h1><blockquote><p>你不知道的JS是一本充满了在使用Javascript开发网站的过程中处理问题的方法的书。</p></blockquote><p><a class="link"   href="https://github.com/getify/You-Dont-Know-JS" >You Don’t Know JS<i class="fas fa-external-link-alt"></i></a></p><h1 id="The-Front-End-Checklist"><a href="#The-Front-End-Checklist" class="headerlink" title="The Front-End Checklist"></a>The Front-End Checklist</h1><blockquote><p>前端清单是您在网站投入生产之前所需的所有元素的列表</p></blockquote><p><a class="link"   href="https://github.com/thedaviddias/Front-End-Checklist" >The Front-End Checklist<i class="fas fa-external-link-alt"></i></a></p><h1 id="Nodejs-Best-Practices"><a href="#Nodejs-Best-Practices" class="headerlink" title="Nodejs Best Practices"></a>Nodejs Best Practices</h1><blockquote><p>Nodejs Best Practices 是一个存储从 Internet 上的项目链接收集的数百篇 Nodejs<br>文章的地方。此外，还分了一些具体的话题，比如如何清理nodejs代码、如何处理错误、如何保护网站、如何测试、如何提高网站速度……使用Nodejs</p></blockquote><p><a class="link"   href="https://github.com/goldbergyoni/nodebestpractices" >Nodejs Best Practices<i class="fas fa-external-link-alt"></i></a></p><h1 id="Awesome"><a href="#Awesome" class="headerlink" title="Awesome"></a>Awesome</h1><blockquote><p>Awesome是一个为开发人员合成几乎完整的链接项目的地方，例如编程语言、前端开发、后端、计算机科学文档、大数据、网络、内容管理系统……</p></blockquote><p><a class="link"   href="https://github.com/sindresorhus/awesome" >Awesome<i class="fas fa-external-link-alt"></i></a></p><h1 id="JavaScript-Algorithms-Va-Data-Structures"><a href="#JavaScript-Algorithms-Va-Data-Structures" class="headerlink" title="JavaScript Algorithms Và Data Structures"></a>JavaScript Algorithms Và Data Structures</h1><blockquote><p>JavaScript 算法和数据结构是常见数据结构和算法的真实世界示例的完整集合。</p></blockquote><p><a class="link"   href="https://github.com/trekhleb/javascript-algorithms/" >JavaScript Algorithms Và Data Structures<i class="fas fa-external-link-alt"></i></a></p><h1 id="Awesome-Python"><a href="#Awesome-Python" class="headerlink" title="Awesome Python"></a>Awesome Python</h1><blockquote><p>Awesome Python 是 Python 程序员的工具和文档集合，例如框架、库、软件……</p></blockquote><p><a class="link"   href="https://github.com/vinta/awesome-python/" >Awesome Python<i class="fas fa-external-link-alt"></i></a></p><h1 id="Full-Stack-Web-Development"><a href="#Full-Stack-Web-Development" class="headerlink" title="Full Stack Web Development"></a>Full Stack Web Development</h1><blockquote><p>Full Stack Web Development 是 100 多个免费项目链接的聚集地，可以学习 HTML、CSS、Nodejs、数据库、API 等网站开发……</p></blockquote><p><a class="link"   href="https://github.com/bmorelli25/Become-A-Full-Stack-Web-Developer/" >Full Stack Web Development<i class="fas fa-external-link-alt"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Free-Programming-Books&quot;&gt;&lt;a href=&quot;#Free-Programming-Books&quot; class=&quot;headerlink&quot; title=&quot;Free Programming Books&quot;&gt;&lt;/a&gt;Free Programming Boo</summary>
      
    
    
    
    <category term="开发工具" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="Github资源" scheme="http://example.com/tags/Github%E8%B5%84%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>mysql文件上传下载  vue下载</title>
    <link href="http://example.com/2021/09/06/java/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E5%9C%A8mysql%E6%95%B0%E6%8D%AE%E5%BA%93,vue%E4%B8%8B%E8%BD%BD/"/>
    <id>http://example.com/2021/09/06/java/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E5%9C%A8mysql%E6%95%B0%E6%8D%AE%E5%BA%93,vue%E4%B8%8B%E8%BD%BD/</id>
    <published>2021-09-06T11:20:12.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>JAVA文件以流的形式存在Mysql(blob)数据库,mysql最大支持4G文件(longblb)</p></blockquote><h3 id="直接将流转换为byte存入数据库"><a href="#直接将流转换为byte存入数据库" class="headerlink" title="直接将流转换为byte存入数据库"></a>直接将流转换为byte存入数据库</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">uploadBlob</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//数据库实体类 改成自己的</span></span><br><span class="line">    FileUpload fileUpload = <span class="keyword">new</span> FileUpload();</span><br><span class="line">    fileUpload.setFileName(file.getOriginalFilename());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        fileUpload.setContent(FileTypeUtils.input2byte(file.getInputStream()));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    save(fileUpload);</span><br><span class="line">    <span class="keyword">return</span> Response.ok(<span class="string">&quot;成功&quot;</span>, fileUpload.getId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 流 转换为byte</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> inStream</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] input2byte(InputStream inStream) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (ByteArrayOutputStream swapStream = <span class="keyword">new</span> ByteArrayOutputStream()) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[inStream.available()];</span><br><span class="line">        <span class="keyword">while</span> (inStream.read(buff) != -<span class="number">1</span>) &#123;</span><br><span class="line">            swapStream.write(buff);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> swapStream.toByteArray();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="下载文件输出文件流到前端"><a href="#下载文件输出文件流到前端" class="headerlink" title="下载文件输出文件流到前端"></a>下载文件输出文件流到前端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFile</span><span class="params">(String id, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">       <span class="comment">// 获取数据库文件信息</span></span><br><span class="line">       FileUpload fileUpload = getById(id);</span><br><span class="line">       <span class="keyword">if</span> (fileUpload.getContent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="comment">//获取存储的文件名称</span></span><br><span class="line">           String filename = fileUpload.getFileName();</span><br><span class="line">           <span class="comment">//获取浏览器版本</span></span><br><span class="line">           String userAgent = request.getHeader(<span class="string">&quot;USER-AGENT&quot;</span>);</span><br><span class="line">           <span class="comment">//IE浏览器</span></span><br><span class="line">           <span class="keyword">if</span> (StringUtils.contains(userAgent, <span class="string">&quot;MSIE&quot;</span>)) &#123;</span><br><span class="line">               filename = URLEncoder.encode(filename, <span class="string">&quot;UTF8&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//google,火狐浏览器</span></span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.contains(userAgent, <span class="string">&quot;Mozilla&quot;</span>)) &#123;</span><br><span class="line">               filename = <span class="keyword">new</span> String(filename.getBytes(), <span class="string">&quot;ISO8859-1&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//其他浏览器</span></span><br><span class="line">           <span class="keyword">else</span> &#123;</span><br><span class="line">               filename = URLEncoder.encode(filename, <span class="string">&quot;UTF8&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="keyword">byte</span>[] fileStream = fileUpload.getContent();</span><br><span class="line">               response.setHeader(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">               <span class="comment">//这边可以设置文件下载时的名字，我这边用的是文件原本的名字，可以根据实际场景设置</span></span><br><span class="line">               response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">               response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(filename, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">               OutputStream toClient = <span class="keyword">new</span> BufferedOutputStream(response.getOutputStream());</span><br><span class="line">               toClient.write(fileStream);</span><br><span class="line">               toClient.flush();</span><br><span class="line">               toClient.close();</span><br><span class="line">           &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="流的方式前端要指定-responseType-‘blob’"><a href="#流的方式前端要指定-responseType-‘blob’" class="headerlink" title="流的方式前端要指定  responseType: ‘blob’"></a>流的方式前端要指定  responseType: ‘blob’</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">   <span class="function"><span class="title">downLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.fileId) &#123;</span><br><span class="line">       request(&#123;</span><br><span class="line">         <span class="attr">url</span>: <span class="string">&quot;localhost:8080/file/getFile&quot;</span>,</span><br><span class="line">         <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">         <span class="attr">params</span>: &#123; <span class="attr">id</span>: <span class="built_in">this</span>.fileId &#125;,</span><br><span class="line">         <span class="comment">//指定 responseType</span></span><br><span class="line">         <span class="attr">responseType</span>: <span class="string">&#x27;blob&#x27;</span></span><br><span class="line">       &#125;).then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([resp],&#123;</span><br><span class="line">           <span class="attr">type</span>:<span class="string">&#x27;application/vnd.ms-excel&#x27;</span></span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="keyword">let</span> objectUrl = URL.createObjectURL(blob);  <span class="comment">//生成一个url</span></span><br><span class="line">         <span class="built_in">this</span>.downloadFile(objectUrl,<span class="built_in">this</span>.form.fileName)</span><br><span class="line">       &#125;);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="转成文件"><a href="#转成文件" class="headerlink" title="转成文件"></a>转成文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> File <span class="title">getFile</span><span class="params">(String id, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 获取数据库文件信息</span></span><br><span class="line">      FileUpload fileUpload = getById(id);</span><br><span class="line">      <span class="keyword">if</span> (fileUpload.getContent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">          File file = <span class="keyword">null</span>;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              file = <span class="keyword">new</span> File(fileUpload.getFileName());</span><br><span class="line">              <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">                  file.createNewFile();</span><br><span class="line">              &#125;</span><br><span class="line">              OutputStream os = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">              os.write(fileUpload.getContent());</span><br><span class="line">              os.close();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> file;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;JAVA文件以流的形式存在Mysql(blob)数据库,mysql最大支持4G文件(longblb)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;直接将流转换为byte存入数据库&quot;&gt;&lt;a href=&quot;#直接将流转换为byte存入数据库&quot; c</summary>
      
    
    
    
    <category term="java" scheme="http://example.com/categories/java/"/>
    
    
    <category term="文件上传下载" scheme="http://example.com/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/"/>
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>IDEA优化</title>
    <link href="http://example.com/2020/10/06/IDEA%E4%BC%98%E5%8C%96/"/>
    <id>http://example.com/2020/10/06/IDEA%E4%BC%98%E5%8C%96/</id>
    <published>2020-10-06T09:47:12.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h1><blockquote><p>IDEA中的java开发辅助插件 </p></blockquote><pre><code>快捷键提示: Key promoter X阿里巴巴编码规约: Alibaba Java Coding Guidelines代码侧边预览: CodeGlance 代码提示工具: Codota AI Autocomplete for Java and JavaScript ,Alibaba Cloud AI Coding AssistantEclipse代码格式化: Eclipse Code Formatteer一键生成实体set方法: GenerateAllSetterJson-&gt;实体转换: GsonFormatPlus热部署: JRebel and XRebel for IntelliJUI美化: Material Theme UIMaven辅助工具: Maven Helper代码生成: MyBatisCodeHelperPro对象转json: POJO to Json翻译: Translation汉化插件: Chinese括号美化: Rainbow Brackets接口查询以及模拟: RestfulTool序列化UUID生成: GenerateSerialVersionUID彩色日志: grep console快捷下划线转驼峰: CamelCase</code></pre><h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><blockquote><p><a class="link"   href="https://www.toutiao.com/i6929867921162273292/?tt_from=weixin&utm_campaign=client_share&wxshare_count=1&timestamp=1613695820&app=news_article&utm_source=weixin&utm_medium=toutiao_ios&use_new_style=1&req_id=202102190850200101511602325911755D&share_token=96477214-F395-4277-AC10-E4DAAB688659&group_id=6929867921162273292" >优化地址<i class="fas fa-external-link-alt"></i></a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;插件&quot;&gt;&lt;a href=&quot;#插件&quot; class=&quot;headerlink&quot; title=&quot;插件&quot;&gt;&lt;/a&gt;插件&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;IDEA中的java开发辅助插件 &lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;快捷键提示: Key</summary>
      
    
    
    
    <category term="开发工具" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="IDEA" scheme="http://example.com/tags/IDEA/"/>
    
  </entry>
  
  <entry>
    <title>Nacos环境搭建(docker)</title>
    <link href="http://example.com/2020/10/06/Nacos%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA(docker)/"/>
    <id>http://example.com/2020/10/06/Nacos%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA(docker)/</id>
    <published>2020-10-06T09:47:12.000Z</published>
    <updated>2024-06-20T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="创建数据挂载目录"><a href="#创建数据挂载目录" class="headerlink" title="创建数据挂载目录"></a>创建数据挂载目录</h2><pre><code>mkdir -p /home/nacos/&#123;conf,nacos-1/&#123;logs&#125;,nacos-2/&#123;logs,nginx&#125;&#125;</code></pre><h2 id="增加公共配置custom-properties"><a href="#增加公共配置custom-properties" class="headerlink" title="增加公共配置custom.properties"></a>增加公共配置custom.properties</h2><pre><code>cd /home/nacos/confvim custom.properties</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">nacos.naming.empty-service.auto-clean=true</span><br><span class="line">nacos.naming.empty-service.clean.initial-delay-ms=50000</span><br><span class="line">nacos.naming.empty-service.clean.period-time-ms=30000</span><br><span class="line"></span><br><span class="line">management.metrics.export.elastic.enabled=false</span><br><span class="line"></span><br><span class="line">management.metrics.export.influx.enabled=false</span><br><span class="line"></span><br><span class="line">server.tomcat.accesslog.enabled=true</span><br><span class="line"></span><br><span class="line">server.tomcat.accesslog.pattern=%h %l %u %t &quot;%r&quot; %s %b %D %&#123;User-Agent&#125;i</span><br><span class="line"></span><br><span class="line">server.tomcat.basedir=</span><br><span class="line"></span><br><span class="line">nacos.security.ignore.urls=/,/error,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/v1/auth/**,/v1/console/health/**,/actuator/**,/v1/console/server/**</span><br><span class="line"></span><br><span class="line">nacos.core.auth.system.type=nacos</span><br><span class="line"></span><br><span class="line">nacos.core.auth.enabled=false</span><br><span class="line"></span><br><span class="line">nacos.core.auth.default.token.expire.seconds=18000</span><br><span class="line"></span><br><span class="line">nacos.core.auth.default.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nacos.core.auth.caching.enabled=true</span><br><span class="line"></span><br><span class="line">nacos.istio.mcp.server.enabled=false</span><br></pre></td></tr></table></figure><h2 id="编写dockerc-compose-yml"><a href="#编写dockerc-compose-yml" class="headerlink" title="编写dockerc-compose.yml"></a>编写dockerc-compose.yml</h2><pre><code>cd /home/nacosvim docker-compose.yml</code></pre><h2 id="单机环境"><a href="#单机环境" class="headerlink" title="单机环境"></a>单机环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3&#x27;</span><br><span class="line">services:</span><br><span class="line">  nacos-server:</span><br><span class="line">    image: nacos/nacos-server:1.4.2</span><br><span class="line">    container_name: nacos-standalone</span><br><span class="line">    ports:</span><br><span class="line">      - 8848:8848</span><br><span class="line">    restart: always</span><br><span class="line">    networks:</span><br><span class="line">      - nacos_net</span><br><span class="line">    privileged: true</span><br><span class="line">    environment:</span><br><span class="line">      MODE: standalone</span><br><span class="line">      PREFER_HOST_MODE: 172.16.10.233  #如果支持主机名可以使用hostname,否则使用ip，默认也是ip</span><br><span class="line">      SPRING_DATASOURCE_PLATFORM: mysql #数据源平台 仅支持mysql或不保存empty</span><br><span class="line">      MYSQL_SERVICE_HOST: 172.16.10.233</span><br><span class="line">      MYSQL_SERVICE_PORT: 3306</span><br><span class="line">      MYSQL_SERVICE_DB_NAME: nacos</span><br><span class="line">      MYSQL_SERVICE_USER: root</span><br><span class="line">      MYSQL_SERVICE_PASSWORD: root</span><br><span class="line">      #JVM调优参数</span><br><span class="line">      JVM_XMS: 512m  #-Xms default :2g</span><br><span class="line">      JVM_MMS: 320m</span><br><span class="line">      JVM_XMX: 512m #-Xmx default :2g</span><br><span class="line">      JVM_XMN: 320m #-Xmn default :1g</span><br><span class="line">    #挂载目录</span><br><span class="line">    volumes:</span><br><span class="line">      - /home/unit/nacos/nacos-standalone/logs:/home/nacos/logs </span><br><span class="line">      - /home/unit/nacos/conf/custom.properties:/home/nacos/init.d/custom.properties </span><br><span class="line">networks:</span><br><span class="line">  nacos_net:</span><br><span class="line">    driver: bridge</span><br></pre></td></tr></table></figure><h3 id="集群环境"><a href="#集群环境" class="headerlink" title="集群环境"></a>集群环境</h3><blockquote><p>这里指定了docker内网的号段，需要提前创建好network，docker network create –driver=bridge –subnet=10.1.1.0/24 test-network</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3&#x27;</span><br><span class="line">networks:</span><br><span class="line">  my_network:</span><br><span class="line">    external: true</span><br><span class="line">    name: test-network</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">   nacos1:</span><br><span class="line">    image: nacos/nacos-server:v2.3.1</span><br><span class="line">    container_name: nacos1</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: true</span><br><span class="line">    environment:</span><br><span class="line">      MODE: cluster</span><br><span class="line">      NACOS_SERVERS: 10.1.1.40:8848,10.1.1.41:8848,10.1.1.42:8848</span><br><span class="line">      PREFER_HOST_MODE: hostname</span><br><span class="line">      SPRING_DATASOURCE_PLATFORM: mysql</span><br><span class="line">      MYSQL_SERVICE_HOST: 10.1.1.2</span><br><span class="line">      MYSQL_SERVICE_PORT: 3306</span><br><span class="line">      MYSQL_SERVICE_DB_NAME: nacos</span><br><span class="line">      MYSQL_SERVICE_USER: xc_ai</span><br><span class="line">      MYSQL_SERVICE_PASSWORD: fp!aRX33!zXS5tW</span><br><span class="line">      NACOS_AUTH_ENABLE: true # 开启鉴权</span><br><span class="line">      NACOS_AUTH_TOKEN: jqn3m9i51vr4tu5ip57zwcb3axbz1r6y6vssh7i5027xq7z5odzfaqvmjnrxenvn </span><br><span class="line">      NACOS_AUTH_IDENTITY_KEY: nacos </span><br><span class="line">      NACOS_AUTH_IDENTITY_VALUE: zwcb3axb</span><br><span class="line"> #JVM调优参数</span><br><span class="line">      JVM_XMS: 320m  #-Xms default :2g</span><br><span class="line">      JVM_MMS: 125m</span><br><span class="line">      JVM_XMX: 320m #-Xmx default :2g</span><br><span class="line">      JVM_XMN: 125m #-Xmn default :1g</span><br><span class="line">    volumes:</span><br><span class="line">      - /home/nacos/cluster1/logs:/home/nacos/logs </span><br><span class="line">      - /home/nacos/cluster1/conf/custom.properties:/home/nacos/init.d/custom.properties </span><br><span class="line">      - /home/nacos/cluster1/data:/home/nacos/data</span><br><span class="line">    networks:</span><br><span class="line">      my_network:</span><br><span class="line">        ipv4_address: 10.1.1.40</span><br><span class="line"></span><br><span class="line">   nacos2:</span><br><span class="line">    image: nacos/nacos-server:v2.3.1</span><br><span class="line">    container_name: nacos2</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: true</span><br><span class="line">    environment:</span><br><span class="line">      MODE: cluster</span><br><span class="line">      NACOS_SERVERS: 10.1.1.40:8848,10.1.1.41:8848,10.1.1.42:8848</span><br><span class="line">      PREFER_HOST_MODE: hostname</span><br><span class="line">      SPRING_DATASOURCE_PLATFORM: mysql</span><br><span class="line">      MYSQL_SERVICE_HOST: 10.1.1.2</span><br><span class="line">      MYSQL_SERVICE_PORT: 3306</span><br><span class="line">      MYSQL_SERVICE_DB_NAME: nacos</span><br><span class="line">      MYSQL_SERVICE_USER: xc_ai</span><br><span class="line">      MYSQL_SERVICE_PASSWORD: fp!aRX33!zXS5tW</span><br><span class="line">      NACOS_AUTH_ENABLE: true # 开启鉴权</span><br><span class="line">      NACOS_AUTH_TOKEN: jqn3m9i51vr4tu5ip57zwcb3axbz1r6y6vssh7i5027xq7z5odzfaqvmjnrxenvn </span><br><span class="line">      NACOS_AUTH_IDENTITY_KEY: nacos </span><br><span class="line">      NACOS_AUTH_IDENTITY_VALUE: zwcb3axb</span><br><span class="line"> #JVM调优参数</span><br><span class="line">      JVM_XMS: 320m  #-Xms default :2g</span><br><span class="line">      JVM_MMS: 125m</span><br><span class="line">      JVM_XMX: 320m #-Xmx default :2g</span><br><span class="line">      JVM_XMN: 125m #-Xmn default :1g</span><br><span class="line">    volumes:</span><br><span class="line">      - /home/nacos/cluster2/logs:/home/nacos/logs </span><br><span class="line">      - /home/nacos/cluster2/conf/custom.properties:/home/nacos/init.d/custom.properties </span><br><span class="line">      - /home/nacos/cluster2/data:/home/nacos/data</span><br><span class="line">    networks:</span><br><span class="line">      my_network:</span><br><span class="line">        ipv4_address: 10.1.1.41</span><br><span class="line">        </span><br><span class="line">   nacos3:</span><br><span class="line">    image: nacos/nacos-server:v2.3.1</span><br><span class="line">    container_name: nacos3</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: true</span><br><span class="line">    environment:</span><br><span class="line">      MODE: cluster</span><br><span class="line">      NACOS_SERVERS: 10.1.1.40:8848,10.1.1.41:8848,10.1.1.42:8848</span><br><span class="line">      PREFER_HOST_MODE: hostname</span><br><span class="line">      SPRING_DATASOURCE_PLATFORM: mysql</span><br><span class="line">      MYSQL_SERVICE_HOST: 10.1.1.2</span><br><span class="line">      MYSQL_SERVICE_PORT: 3306</span><br><span class="line">      MYSQL_SERVICE_DB_NAME: nacos</span><br><span class="line">      MYSQL_SERVICE_USER: xc_ai</span><br><span class="line">      MYSQL_SERVICE_PASSWORD: fp!aRX33!zXS5tW</span><br><span class="line">      NACOS_AUTH_ENABLE: true # 开启鉴权</span><br><span class="line">      NACOS_AUTH_TOKEN: jqn3m9i51vr4tu5ip57zwcb3axbz1r6y6vssh7i5027xq7z5odzfaqvmjnrxenvn </span><br><span class="line">      NACOS_AUTH_IDENTITY_KEY: nacos </span><br><span class="line">      NACOS_AUTH_IDENTITY_VALUE: zwcb3axb</span><br><span class="line"> #JVM调优参数</span><br><span class="line">      JVM_XMS: 320m  #-Xms default :2g</span><br><span class="line">      JVM_MMS: 125m</span><br><span class="line">      JVM_XMX: 320m #-Xmx default :2g</span><br><span class="line">      JVM_XMN: 125m #-Xmn default :1g</span><br><span class="line">    volumes:</span><br><span class="line">      - /home/nacos/cluster3/logs:/home/nacos/logs </span><br><span class="line">      - /home/nacos/cluster3/conf/custom.properties:/home/nacos/init.d/custom.properties </span><br><span class="line">      - /home/nacos/cluster3/data:/home/nacos/data</span><br><span class="line">    networks:</span><br><span class="line">      my_network:</span><br><span class="line">        ipv4_address: 10.1.1.42</span><br><span class="line">    </span><br></pre></td></tr></table></figure><h3 id="编写nginx代理"><a href="#编写nginx代理" class="headerlink" title="编写nginx代理"></a>编写nginx代理</h3><blockquote><p>2.0之后使用rpc访问有一个端口偏移，需要在nginx配置中指定</p></blockquote><h4 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h4><pre><code>cd /home/nginx/confvim nginx.conf</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"># tpc服务</span><br><span class="line">stream &#123;</span><br><span class="line">    # tcp负载均衡</span><br><span class="line">    upstream nacos-grpc &#123;</span><br><span class="line">        server 10.1.1.40:9848 weight=1;</span><br><span class="line">        server 10.1.1.41:9848 weight=1;</span><br><span class="line">        server 10.1.1.42:9848 weight=1;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">                                                   </span><br><span class="line">    # Nacos服务端gRPC请求服务端端口</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 10999;</span><br><span class="line">        proxy_pass nacos-grpc;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h4 id="nacos-conf"><a href="#nacos-conf" class="headerlink" title="nacos.conf"></a>nacos.conf</h4><pre><code>cd /home/nginx/conf.dvim nacos.conf</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">upstream nacosserver &#123;</span><br><span class="line">            server 10.1.1.40:8848 weight=1;</span><br><span class="line">            server 10.1.1.41:8848 weight=1;</span><br><span class="line">            server 10.1.1.42:8848 weight=1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       9999;</span><br><span class="line">      server_name localhost;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://nacosserver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="执行启动命令"><a href="#执行启动命令" class="headerlink" title="执行启动命令"></a>执行启动命令</h1><pre><code>docker-compose up -d </code></pre><blockquote><p>最后只需要用nginx进行代理转发就好了</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;创建数据挂载目录&quot;&gt;&lt;a href=&quot;#创建数据挂载目录&quot; class=&quot;headerlink&quot; title=&quot;创建数据挂载目录&quot;&gt;&lt;/a&gt;创建数据挂载目录&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;mkdir -p /home/nacos/&amp;#123;conf,nacos-</summary>
      
    
    
    
    <category term="docker" scheme="http://example.com/categories/docker/"/>
    
    
    <category term="nacos" scheme="http://example.com/tags/nacos/"/>
    
  </entry>
  
</feed>
